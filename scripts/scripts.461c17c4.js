"use strict";angular.module("geomeditApp",["ui.router","ngAnimate","mgcrea.ngStrap","pascalprecht.translate","LocalStorageModule"]).config(["$stateProvider","$urlRouterProvider","localStorageServiceProvider",function(a,b,c){a.state("home",{url:"/",templateUrl:"views/home.html"}).state("blog",{url:"/blog",templateUrl:"views/home.html"}).state("sketch",{url:"/sketch",templateUrl:"views/sketch.html",controller:"MainCtrl"}).state("sketch.toolbox",{url:"/tool",templateUrl:"views/toolbox.html",controller:"ToolboxCtrl"}).state("sketch.properties",{url:"/prop",templateUrl:"views/properties.html",controller:"PropCtrl"}),b.otherwise("/sketch"),c.setPrefix("geomedit")}]),angular.module("geomeditApp").config(["$translateProvider",function(a){var b=navigator?navigator.language||navigator.userLanguage:null;a.translations("en",{Languages:"UI language",ShowTooltip:"Show tooltip",SnapOptions:"Snapping options",SnapVertex:"Snap to vertex",SnapMid:"Snap to midpoint",SnapCross:"Snap to intersection",SnapGlider:"Snap to edge",ProjectMode:"Large screen projection",ProjectName:"Geometry Online",ProjectDesc:"Dynamic Mathematics with JSXGraph",Blog:"Blog",StartSketch:"Start for sketch",Loading:"Loading...",Cmd_:"Select",CmdPoint:"Point",CmdMidpoint:"Midpoint",CmdIntersection:"Intersection",CmdGlider:"Glider point",CmdPerpPoint:"Perpendicular point",CmdReflection:"Reflected point",CmdInCenter:"Inscribed center",CmdSegment:"Segment",CmdRay:"Half-line",CmdLine:"Infinite line",CmdParallel:"Parallel line",CmdPerpSegment:"Perpendicular segment",CmdPerpLine:"Perpendicular line",CmdBisector:"Angle bisector",CmdTriangle:"Triangle",CmdQuadrangle:"Quadrangle",CmdPolygon:"Polygon",CmdParallelogram:"Parallelogram",CmdCircle2p:"Circle with center",CmdCircle3p:"Circle through 3 points",CmdInCircle:"Inscribed circle",SelectShape:"Please select a shape.",SelectOption:"Select",FaceCircle:"Circle",FaceCross:"Cross",FacePlus:"Plus",FaceDiamond:"Diamond",FaceSquare:"Square",FaceUpTriangle:"Up triangle",FaceDownTriangle:"Down triangle",FaceLeftTriangle:"Left triangle",FaceRightTriangle:"Right triangle",PosLeft:"Left",PosRight:"Right",PosCenter:"Center",SolidLine:"Solid line",DottedLine:"Dotted line",SmallDashes:"Small dashes",MediumDashes:"Medium dashes",BigDashes:"Big dashes",LargeGaps:"Large gaps -.-",SmallGaps:"Small gaps -.-",PropLabel:"Label",PropText:"Text",PropFontSize:"Text size",PropTextColor:"Text color",PropFixed:"Fixed",PropTrace:"Trace",PropRange:"Range",PropSnapWidth:"Snap width",PropFace:"Face",PropSize:"Size",PropPosition:"Position",PropOffset:"Offset",PropDash:"Dash",PropStrokeWidth:"Stroke width",PropStrokeColor:"Stroke color",PropStrokeOpacity:"Stroke opacity",PropFillColor:"Fill color",PropFillOpacity:"Fill opacity",PropColor:"Color",PropOpacity:"Opacity",PropHideColor:"Hide color bar",PropExpandColor:"Show color bar",PropInnerPoints:"Drag inner area",PropCoords:"Coords",PropSnapToGrid:"Snap to a grid",PropSnapToPoints:"Snap to the nearest point",PropZoomSize:"Changes on zoom events",PropLineEndings:"Line endings",PropRadius:"Radius",PropCenterVisible:"Show center",PropFunctionTerm:"Function term",PropBoard:"Drawing area",PropDraggable:"Can drag objects",PropIgnoreLabels:"Can drag labels",PropGrid:"Grid",PropAxis:"Axis",PropOrigin:"Origin",PropUnits:"Units",PropDrawLabels:"Draw labels",PropDrawZero:"Zero tick",PropInsertTicks:"Auto insert ticks",PropScaleSymbol:"Unit of labels",PropTicksDistance:"Ticks distance",PropMajorHeight:"Infinite tick line",PropMinorTicks:"Minor ticks count",ShowSidebar:"Show sidebar",HideSidebar:"Hide sidebar",CancelCmd:"Cancel the current tool",Toolbox:"Toolbox view",Properties:"Properties view",ZoomIn:"Zoom In",ZoomOut:"Zoom Out",ZoomDefault:"Default Zoom",ShowNavigators:"Show the navigation bar",HideNavigators:"Hide the navigation bar",PanUp:"Pan Up",PanDown:"Pan Down",PanLeft:"Pan Left",PanRight:"Pan Right",ShowAllObjects:"List all objects",HideObject:"Hide object",ShowObject:"Show object",HideLabel:"Hide label",ShowLabel:"Show label",ArrowLast:"Arrow head at the second point",ArrowFirst:"Arrow head at the first point",RestrictLast:"Stop at the second point",RestrictFirst:"Stop at the first point",RecreateBoard:"Reset",Undo:"Undo",Redo:"Redo",Options:"Options",Home:"Home"}).translations("cn",{Languages:"界面语言",ShowTooltip:"显示工具提示",SnapOptions:"捕捉选项",SnapVertex:"允许捕捉顶点",SnapMid:"允许捕捉中点",SnapCross:"允许捕捉交点",SnapGlider:"允许捕捉线上点",ProjectMode:"大屏投影模式",ProjectName:"几何绘图",ProjectDesc:"基于 JSXGraph 的在线动态几何编辑平台",Blog:"博客",StartSketch:"开始绘图",Loading:"正在加载...",Cmd_:"选择",Point:"点",CmdPoint:"点",CmdMidpoint:"中点",CmdIntersection:"交点",CmdGlider:"线上点",CmdPerpPoint:"垂足",CmdReflection:"对称点",CmdInCenter:"三点内心",Line:"直线",CmdSegment:"线段",CmdRay:"射线",CmdLine:"直线",CmdParallel:"平行线",CmdPerpSegment:"垂线段",CmdPerpLine:"垂线",CmdBisector:"角平分线",Polygon:"多边形",CmdTriangle:"三角形",CmdQuadrangle:"四边形",CmdPolygon:"多边形",CmdParallelogram:"平行四边形",Circle:"圆",CmdCircle2p:"圆心圆",CmdCircle3p:"过三点画圆",CmdInCircle:"三点内切圆",SelectShape:"请选择一个图形",SelectOption:"选择",FaceCircle:"圆点",FaceCross:"叉号",FacePlus:"加号",FaceDiamond:"菱形",FaceSquare:"方形",FaceUpTriangle:"上三角形",FaceDownTriangle:"下三角形",FaceLeftTriangle:"左三角形",FaceRightTriangle:"右三角形",PosLeft:"左侧",PosRight:"右侧",PosCenter:"中间",SolidLine:"实线",DottedLine:"点线",SmallDashes:"短虚线",MediumDashes:"中虚线",BigDashes:"长虚线",LargeGaps:"大间距点划线",SmallGaps:"小间距点划线",PropLabel:"标签",PropText:"文字",PropFontSize:"文字大小",PropTextColor:"文字颜色",PropFixed:"固定",PropTrace:"跟踪位置",PropRange:"变化范围",PropSnapWidth:"捕捉宽度",PropFace:"外观",PropSize:"大小",PropPosition:"位置",PropOffset:"偏移",PropDash:"虚线",PropStrokeWidth:"线宽",PropStrokeColor:"线条颜色",PropStrokeOpacity:"线条不透明度",PropFillColor:"填充颜色",PropFillOpacity:"填充不透明度",PropColor:"颜色",PropOpacity:"不透明度",PropHideColor:"收起颜色条",PropExpandColor:"展开颜色条",PropCoords:"坐标",PropSnapToGrid:"捕捉到网格点",PropSnapToPoints:"捕捉到附近点",PropZoomSize:"放缩时大小自适应",PropLineEndings:"线端类型",PropInnerPoints:"可拖动内部区域",PropRadius:"半径",PropCenterVisible:"显示圆心",PropFunctionTerm:"函数式",PropBoard:"绘图区",PropDraggable:"允许拖动图形",PropIgnoreLabels:"允许拖动标签",PropGrid:"网格",PropAxis:"坐标轴",PropOrigin:"原点",PropUnits:"单位",PropDrawLabels:"显示刻度文字",PropDrawZero:"显示零刻度",PropInsertTicks:"自动插入刻度",PropScaleSymbol:"刻度单位",PropTicksDistance:"刻度线距离",PropMajorHeight:"主刻度线延长",PropMinorTicks:"小刻度数",ShowSidebar:"展开操作面板",HideSidebar:"收起操作面板",CancelCmd:"取消当前工具",Toolbox:"工具",Properties:"属性",ZoomIn:"放大",ZoomOut:"缩小",ZoomDefault:"默认比例",ShowNavigators:"显示导航条",HideNavigators:"隐藏导航条",PanUp:"向上平移",PanDown:"向下平移",PanLeft:"向左平移",PanRight:"向右平移",ShowAllObjects:"列出所有图形",HideObject:"隐藏本图形",ShowObject:"显示本图形",HideLabel:"隐藏标签",ShowLabel:"显示标签",ArrowLast:"终点有箭头",ArrowFirst:"起点有箭头",RestrictLast:"终点不延长",RestrictFirst:"起点不延长",RecreateBoard:"重置",Undo:"撤销",Redo:"重做",Options:"选项",Home:"首页"}).preferredLanguage(b&&b.toLowerCase().indexOf("cn")>=0?"cn":"en").useSanitizeValueStrategy(null)}]),angular.module("geomeditApp").controller("RootCtrl",["$scope","$state","$translate","localStorageService",function(a,b,c,d){c.use(d.get("lang")),a.switchLanguage=function(a){c.use(a),d.set("lang",a)}}]),angular.module("geomeditApp").factory("model",function(){return{snap:{vertex:!0,mid:!0,cross:!0,glider:!0,project:!1,items:[{type:"switch",id:"vertex",title:"SnapVertex"},{type:"switch",id:"mid",title:"SnapMid"},{type:"switch",id:"cross",title:"SnapCross"},{type:"switch",id:"glider",title:"SnapGlider"},{type:"switch",id:"project",title:"ProjectMode"}]},initAttr:{originX:100,originY:400,unitX:20,unitY:20,keepAspectRatio:!0,axis:!0,grid:!0,showCopyright:!1,showNavigation:!1,registerEvents:!1},initOptions:{board:{ignoreLabels:!1},axis:{label:{position:"rt",offset:[-10,-10]},ticks:{insertTicks:!1,ticksDistance:5,majorHeight:30}},label:{fixed:!1},precision:{hasPoint:8},point:{withLabel:!1},midpoint:{size:4,face:"^",fillColor:"none"},intersection:{face:"x"},glider:{face:"diamond",fillColor:"#00dd00",strokeColor:"#00dd00"},polygon:{hasInnerPoints:!0},regularPolygon:{hasInnerPoints:!0}},uiOptions:{highlightColor:"#ddd",highlightSize:12,highlightOpacity:.6},board:null,drafts:[],snaps:[],pendings:null,propObj:null,selection:[],commands:[],cmdGroups:[],command:null,draggable:!0,create:function(a,b,c){return this.board.create(a,b,c)},findCommand:function(a){var b,c;for(b=0,c=this.commands.length;c>b;b++)if(this.commands[b].id===a)return this.commands[b];return null},findCommandGroup:function(a){var b,c;for(b=0,c=this.cmdGroups.length;c>b;b++)if(this.cmdGroups[b].name===a)return this.cmdGroups[b];return null},addCommand:function(a,b){if(b&&b.id&&JXG.isString(b.id)&&a&&JXG.isString(a)){var c=this.findCommand(b.id);if(c)JXG.extend(c,b);else{this.commands.push(b);var d=this.findCommandGroup(a);d||(d={name:a,commands:[]},this.cmdGroups.push(d)),d.commands.push(b)}}}}}),angular.module("geomeditApp").controller("MainCtrl",["$scope","$state","$timeout","localStorageService","header","commands","properties","model","boardUI",function(a,b,c,d,e,f,g,h,i){a.leftButtons=e.leftButtons,a.rightButtons=e.rightButtons,a.toolbox=f,a.snap=h.snap,a.zooms=i.zooms,e.homeBtn.click=function(){b.go("home")},a.tooltip={show:!JXG.isApple()},a.sidebar={views:[{state:"toolbox",icon:"wrench"},{state:"properties",icon:"sliders"}],state:"",hidden:d.get("sidebarHidden"),go:function(a,c){this.state!==a&&(this.state=a,c||(b.go("sketch."+a),d.set("sideView",a)))},toggleVisible:function(){this.hidden=!this.hidden,d.set("sidebarHidden",this.hidden)}},b.get("sketch").onExit=function(){i.freeBoard()},a.recreateBoard=function(){i.initBoard(i.freeBoard()),a.$applyAsync()};var j=b.get("sketch.properties");j.onEnter=g.onEnter,j.onExit=g.onExit,c(function(){a.sidebar.go(a.sidebar.state||"toolbox")},50)}]),angular.module("geomeditApp").service("header",[function(){var a=!1,b=!1,c={tooltip:"Undo",icon:"reply",disabled:function(){return!a},click:function(){this.disabled()||(a=!a)}},d={tooltip:"Redo",icon:"share",disabled:function(){return!b},click:function(){this.disabled()||(b=!b)}},e={tooltip:"Options",icon:"cog",popover:"options",click:function(a){a.showOptionsPopover()}};this.homeBtn={tooltip:"Home",icon:"home"},this.leftButtons=[c,d],this.rightButtons=[e,this.homeBtn]}]),angular.module("geomeditApp").directive("edPopover",["$popover",function(a){function b(b,c,d){return a(c,{contentTemplate:d,html:!0,trigger:"manual",placement:"bottom",autoClose:!0,scope:b})}return{link:function(a,c,d){switch(d.edPopover){case"options":var e=b(a,c,"views/options.html");a.showOptionsPopover=function(){e.show()}}}}}]),angular.module("geomeditApp").directive("leftExpandable",["boardUI",function(a){return{link:function(b,c){var d=parseFloat(c.css("margin-left"))+1;b.$watch("sidebar.hidden",function(b){c.css("margin-left",b?0:d),b&&a.resizeBoard(c.width(),c.height())}),b.$watchGroup([function(){return c.width()},function(){return c.height()}],function(c){b.sidebar.hidden||a.resizeBoard(c[0],c[1])});var e=window.onresize||angular.noop;window.onresize=function(){e(),a.resizeBoard(c.width(),c.height())}}}}]),angular.module("geomeditApp").factory("properties",["model","eventHandler","commands","select",function(a,b,c,d){function e(a,b,c,d){var e=["label","fontSize","textColor","fixed","trace"];return"board"===a?e=["draggable","ignoreLabels","grid","axis","origin","units"]:"slider"===c?e=["range","snapWidth","face","size","label","fontSize","textColor","strokeWidth","strokeColor","strokeOpacity","fillColor","fillOpacity"]:a===JXG.OBJECT_CLASS_POINT?e=["coords","face","size","color","opacity"].concat(e):a===JXG.OBJECT_CLASS_LINE?e=["lineEndings","dash","strokeWidth","strokeColor","strokeOpacity"].concat(e):a===JXG.OBJECT_CLASS_CIRCLE?e=["radius","centerVisible","dash","strokeWidth","strokeColor","strokeOpacity","fillColor","fillOpacity"].concat(e):b===JXG.OBJECT_TYPE_POLYGON?e=["innerPoints","dash","strokeWidth","strokeColor","strokeOpacity","fillColor","fillOpacity"].concat(e):b===JXG.OBJECT_TYPE_ANGLE?e=["radius","label","fontSize","textColor","dash","strokeWidth","strokeColor","strokeOpacity","fillColor","fillOpacity"]:b===JXG.OBJECT_TYPE_SECTOR?e=["label","fontSize","textColor","dash","strokeWidth","strokeColor","strokeOpacity","fillColor","fillOpacity"]:b===JXG.OBJECT_TYPE_GRID?e=["dash","strokeWidth","strokeColor","strokeOpacity"]:a===JXG.OBJECT_CLASS_CURVE?e=["functionTerm","dash","strokeWidth","strokeColor","strokeOpacity","fillColor","fillOpacity"].concat(e):b===JXG.OBJECT_TYPE_TEXT?(e=["text","fontSize","textColor","fixed"],d&&d.getAttribute("isLabel")&&!JXG.isPoint(d.element)&&e.unshift("position","offset")):b===JXG.OBJECT_TYPE_TICKS&&(e=["drawLabels","drawZero","insertTicks","majorHeight","scaleSymbol","ticksDistance","minorTicks"]),e.indexOf("label")>-1&&!d.label&&(e.splice(e.indexOf("fontSize"),1),e.splice(e.indexOf("textColor"),1)),e}function f(b,c){var d=a.propObj.setAttribute(b);return a.propObj.borders&&a.propObj.borders.forEach(function(a){a.setAttribute(b)}),c&&a.propObj.vertices&&a.propObj.vertices.forEach(function(a){a.setAttribute(b)}),d}function g(a,b,c){var d=/^-?\d+\.?\d*$/,e=parseFloat(a);return JXG.exists(a)&&d.test(a)&&e>b-1e-5&&c+1e-5>e}function h(b,c){return JXG.deepCopy(JXG.deepCopy({type:"number"},c||{}),{get:function(){this.value=a.propObj.getAttribute(b)},set:function(){if(g(this.value,this.min,this.max)){var c={};return c[b]=parseFloat(this.value),a.propObj.setAttribute(c)}}})}function i(b,c){return{type:"checkbox",get:function(){var d=c?a.propObj[c]:a.propObj;this.value=d.getAttribute(b)},set:function(){var d={},e=c?a.propObj[c]:a.propObj;return d[b]=!!this.value,e.setAttribute(d)}}}function j(a){return a&&"none"!==a&&a.indexOf("#")<0?JXG.rgb2hex(a):a}function k(a){return"none"===a||3===JXG.rgbParser(a).length}var l=!1,m={},n={};return n.options={faces:[{id:"",title:"SelectOption"},{id:"o",title:"FaceCircle"},{id:"x",title:"FaceCross"},{id:"+",title:"FacePlus"},{id:"<>",title:"FaceDiamond"},{id:"[]",title:"FaceSquare"},{id:"^",title:"FaceUpTriangle"},{id:"v",title:"FaceDownTriangle"},{id:"<",title:"FaceLeftTriangle"},{id:">",title:"FaceRightTriangle"}],positions:[{id:"",title:"SelectOption"},{id:"lft",title:"PosLeft"},{id:"rt",title:"PosRight"},{id:"top",title:"PosCenter"}],dashes:[{id:"",title:"SelectOption"},{id:"0",title:"SolidLine"},{id:"1",title:"DottedLine"},{id:"2",title:"SmallDashes"},{id:"3",title:"MediumDashes"},{id:"4",title:"BigDashes"},{id:"5",title:"LargeGaps"},{id:"6",title:"SmallGaps"}],colors:["none","#000000","#eeeeee","#808080","#ff00ff","#cc0000","#ffa500","#ffff00","#3366ff","#00ffff","#006400","#00ff00"]},n.id="",n.items=[],n.updateView=angular.noop,n.onEnter=function(){l=!0,c.cancel(),n.fetch()},n.onExit=function(){l=!1,a.propObj=null,n.fetch()},b.customDownHandlers.push(function(){l&&(a.propObj=a.board.downObjects[0],n.fetch())}),b.customMoveHandlers.push(function(){l&&a.propObj&&n.fetch()}),n.validID=function(a){return a&&0!==a.indexOf("_")&&!a.match(/_ticks_\d+Label/)?a:""},n.fetch=function(){var b,c=[],f=[];JXG.isString(a.propObj)?(n.id=a.propObj,f=e(a.propObj)):(n.id=a.propObj?a.propObj.id:"",n.validID(n.id)&&(f=e(a.propObj.elementClass,a.propObj.type,a.propObj.elType,a.propObj))),f.forEach(function(a){b=m[a],b&&b.get&&b.get()!==!1&&(b.oldValue=JXG.isObject(b.value)?JXG.deepCopy({},b.value):b.value,b.id=a,c.push(b))}),n.items.length=0,JXG.extend(n.items,c),n.updateView(),d.select(a.propObj,!0)},n.needSave=function(){var b=0;return a.propObj&&n.items.forEach(function(a){JSON.stringify(a.value)!==JSON.stringify(a.oldValue)&&b++}),b>0},n.save=function(){if(a.propObj){var b,c=!1;n.items.forEach(function(a){JSON.stringify(a.value)!==JSON.stringify(a.oldValue)&&(b=a.set(),c=c||void 0!==b&&b!==!1,a.oldValue=JXG.isObject(a.value)?JXG.deepCopy({},a.value):a.value)}),c&&a.board.update()}},m.snapWidth={type:"range",min:1,max:100,get:function(){this.value=a.propObj.getAttribute("snapWidth")},set:function(){return g(this.value,this.min,this.max)?a.propObj.setAttribute({snapWidth:parseInt(this.value)}):void 0}},m.strokeWidth={type:"range",unit:"px",min:.5,max:50,step:.5,get:function(){this.value=a.propObj.getAttribute("strokeWidth")},set:function(){return g(this.value,this.min,this.max)?f({strokeWidth:parseFloat(this.value)}):void 0}},m.dash={type:"dash",get:function(){this.value=a.propObj.getAttribute("dash").toString()},set:function(){return this.value?f({dash:parseInt(this.value)}):void 0}},m.strokeOpacity={type:"range",unit:"%",min:1,max:100,get:function(){this.value=Math.round(100*a.propObj.getAttribute("strokeOpacity"))},set:function(){return f({strokeOpacity:.01*this.value})}},m.fillOpacity={type:"range",unit:"%",min:1,max:100,get:function(){this.value=Math.round(100*a.propObj.getAttribute("fillOpacity"))},set:function(){return a.propObj.setAttribute({fillOpacity:.01*this.value})}},m.opacity={type:"range",unit:"%",min:1,max:100,get:function(){this.value=Math.round(100*a.propObj.getAttribute("fillOpacity"))},set:function(){return a.propObj.setAttribute({strokeOpacity:.01*this.value,fillOpacity:.01*this.value})}},m.size={type:"size",unit:"px",min:.5,max:50,step:.5,get:function(){this.value={size:a.propObj.getAttribute("size"),zoom:a.propObj.getAttribute("zoom")},this.value.size=a.propObj.getAttribute("size"),this.value.zoom=a.propObj.getAttribute("zoom")},set:function(){if(g(this.value.size,this.min,this.max)){var b=parseFloat(this.value.size);return a.propObj.setAttribute({zoom:this.value.zoom,size:b,strokeWidth:b/10})}}},m.coords={type:"coords",get:function(){this.value={x:a.propObj.coords.usrCoords[1],y:a.propObj.coords.usrCoords[2],snapToGrid:a.propObj.getAttribute("snapToGrid"),snapToPoints:a.propObj.getAttribute("snapToPoints")}},set:function(){var b=/^-?\d+\.?\d*$/,c=parseFloat(this.value.x),d=parseFloat(this.value.y),e=function(a){return Math.abs(a)<1e3},f=a.propObj.getAttribute("attractorDistance"),g=a.propObj.getAttribute("attractorUnit");return this.value.snapToPoints&&1e-5>f&&(f=Math.max(a.board.options.precision.hasPoint,10),g="screen"),b.test(this.value.x)&&b.test(this.value.y)&&e(c)&&e(d)?(a.propObj.setAttribute({snapToGrid:this.value.snapToGrid,snapToPoints:this.value.snapToPoints,attractorDistance:f,attractorUnit:g}),a.propObj.setPositionDirectly(JXG.COORDS_BY_USER,[c,d])):void 0}},m.lineEndings={type:"lineEndings",get:function(){var b=a.propObj.visProp;this.value={restrictFirst:!b.straightfirst,restrictLast:!b.straightlast,arrowFirst:b.firstarrow,arrowLast:b.lastarrow}},set:function(){var b=this.value;return a.propObj.setAttribute({straightFirst:!b.restrictFirst,straightLast:!b.restrictLast,firstArrow:b.arrowFirst,lastArrow:b.arrowLast})}},m.face={type:"face",get:function(){this.value=a.propObj.getAttribute("face")},set:function(){return this.value?a.propObj.setAttribute({face:this.value}):void 0}},m.fixed={type:"checkbox",icon1:"lock",icon0:"unlock",get:function(){this.value=a.propObj.getAttribute("fixed")},set:function(){return f({fixed:this.value},!0)}},m.trace=i("trace"),m.strokeColor={type:"color",get:function(){this.value=j(a.propObj.getAttribute("strokeColor"))},set:function(){return k(this.value)?f({strokeColor:this.value}):void 0}},m.fillColor={type:"color",get:function(){this.value=j(a.propObj.getAttribute("fillColor"))},set:function(){return k(this.value)?a.propObj.setAttribute({fillColor:this.value}):void 0}},m.color={type:"color",get:function(){this.value=j(a.propObj.getAttribute("fillColor"))},set:function(){return k(this.value)?a.propObj.setAttribute({strokeColor:this.value,fillColor:this.value}):void 0}},m.radius={type:"number",step:.1,get:function(){this.value=a.propObj.Radius(),this.readonly=a.propObj.method&&"pointRadius"!==a.propObj.method},set:function(){return"pointRadius"===a.propObj.method?a.propObj.setRadius(this.value):void 0}},m.centerVisible=i("visible","center"),m.label={type:"label",get:function(){this.value={withLabel:!!a.propObj.getAttribute("withLabel"),name:a.propObj.getName()}},set:function(){this.value.name=this.value.name.replace(/(^\s*)|(\s*$)/g,"");var b=!(!this.value.withLabel||!this.value.name),c=!a.propObj.label;return this.value.name&&this.value.name!==this.oldValue.name&&(b=!0,this.value.withLabel=!0),a.propObj.setAttribute({withLabel:b}),this.value.name&&this.value.name!==this.oldValue.name&&(a.propObj.setName(this.value.name),a.propObj.label.setAttribute({visible:!0})),b&&c?n.fetch():!b||m.fontSize.value&&m.textColor.value||(m.fontSize.get(),m.textColor.get(),n.updateView()),!0}},m.position={type:"position",get:function(){var a=this.element();this.value=a?a.getAttribute("position"):""},set:function(){var a=this.element();return a&&a.setAttribute({position:this.value})},element:function(){return a.propObj?a.propObj.label||a.propObj:null}},m.offset={type:"xy",min:-200,max:200,unit:"px",get:function(){var b=a.propObj.getAttribute("offset");this.value={x:b[0],y:b[1]}},set:function(){return g(this.value.x,this.min,this.max)&&g(this.value.y,this.min,this.max)?a.propObj.setAttribute({offset:[parseInt(this.value.x),parseInt(this.value.y)]}):void 0}},m.fontSize={type:"number",min:8,max:500,step:.5,get:function(){var a=this.element();this.value=a?a.getAttribute("fontSize"):""},set:function(){var a=this.element();return a&&g(this.value,this.min,this.max)?a.setAttribute({fontSize:parseFloat(this.value)}).updateSize():void 0},element:function(){return a.propObj?a.propObj.label||a.propObj:null}},m.textColor={type:"color",get:function(){var a=this.element();this.value=a?a.getAttribute("strokeColor"):""},set:function(){var a=this.element();return a&&this.value?a.setAttribute({strokeColor:this.value}):void 0},element:function(){return a.propObj?a.propObj.label||a.propObj:null}},m.draggable={type:"checkbox",get:function(){this.value=a.draggable},set:function(){return a.draggable=!!this.value,!0}},m.ignoreLabels={type:"checkbox",get:function(){this.value=a.board.attr.ignorelabels},set:function(){return a.board.attr.ignorelabels=!!this.value,!0}},m.grid={type:"checkbox",get:function(){this.value=a.board.grids.length>0&&a.board.grids[0].getAttribute("visible")},set:function(){var b={visible:!!this.value};return a.board.grids.forEach(function(a){a.setAttribute(b)}),!0}},m.axis={type:"checkbox",get:function(){var b=JXG.filterElements(a.board.objectsList,{type:JXG.OBJECT_TYPE_AXIS});this.value=b[0]&&b[0].getAttribute("visible")},set:function(){var b=JXG.filterElements(a.board.objectsList,{type:JXG.OBJECT_TYPE_AXIS}),c={visible:!!this.value};return b.forEach(function(a){a.setAttribute(c)}),!0}},m.origin={type:"xy",min:0,max:2e3,unit:"px",get:function(){this.value={x:a.board.origin.scrCoords[1],y:a.board.origin.scrCoords[2]}},set:function(){if(!(JXG.exists(this.value.x)&&!g(this.value.x,this.min,this.max)||JXG.exists(this.value.y)&&!g(this.value.y,this.min,this.max))){var b=JXG.exists(this.value.x)?parseInt(this.value.x):a.board.canvasWidth/2,c=JXG.exists(this.value.y)?parseInt(this.value.y):a.board.canvasHeight/2;return a.board.moveOrigin(b,c)}}},m.units={type:"xy",min:1,max:1e3,unit:"px",get:function(){this.value={x:a.board.unitX,y:a.board.unitY}},set:function(){return g(this.value.x,this.min,this.max)&&g(this.value.y,this.min,this.max)?(a.board.unitX=parseFloat(this.value.x),a.board.unitY=parseFloat(this.value.y),a.board.updateCoords().clearTraces().fullUpdate()):void 0}},m.majorHeight={type:"checkbox",get:function(){this.value=a.propObj.getAttribute("majorHeight")<0},set:function(){var b=Math.abs(a.propObj.getAttribute("majorHeight"));return a.propObj.setAttribute({majorHeight:this.value?-b:b})}},m.scaleSymbol={type:"text",get:function(){this.value=a.propObj.getAttribute("scaleSymbol")},set:function(){return a.propObj.setAttribute({scaleSymbol:this.value})}},m.innerPoints=i("hasInnerPoints"),m.drawLabels=i("drawLabels"),m.drawZero=i("drawZero"),m.insertTicks=i("insertTicks"),m.ticksDistance=h("ticksDistance",{min:1,max:50}),m.minorTicks=h("minorTicks",{min:0,max:9}),n}]),angular.module("geomeditApp").controller("PropCtrl",["$scope","properties","model","select",function(a,b,c,d){a.options=b.options,a.items=b.items,a.sidebar.go("properties",!0),a.trimID=function(a){return a.replace(/.*Board\d*/,"")},a.info=function(b){var d={};return b=JXG.def(b,c.propObj),b&&b.getAttribute&&(d.id=b.id,d.type=b.type,d.elType=b.type===JXG.OBJECT_TYPE_AXISPOINT?"axispoint":b.type===JXG.OBJECT_TYPE_TICKS?"ticks":b.elType,d.description=a.trimID(d.id),d.description.indexOf(d.elType)<0&&(d.description+=": "+d.elType),d.visible=b.getAttribute("visible")),d},a.objects=function(){var d=(c.board?c.board.objectsList:[]).filter(function(c){return b.validID(a.trimID(c.id))});return d.reverse()},a.clearSelection=function(){c.propObj=null,b.fetch()},a.selectObject=function(a){c.propObj=a,b.fetch()},a.switchVisible=function(a){a=a?a:c.propObj,a.setAttribute({visible:!a.getAttribute("visible")})},a.removeObject=function(a){d.resetSelection(),c.board.removeObject(a)},a.highlight=function(){return d.highlight.apply(d,arguments)},b.updateView=function(){a.$applyAsync()},a.$watch(b.needSave,function(a){a&&b.save()})}]),angular.module("geomeditApp").filter("concatUnit",function(){return function(a,b,c){return c=c?c:14,a+(b&&a.length<c?"("+b+")":"")}}),angular.module("geomeditApp").filter("truncate",function(){return function(a,b,c){return a?(b=b?b:10,c=JXG.def(c,"…"),a.length<=b||a.length-c.length<=b?a:a.substring(0,b-c.length)+c):a}}),angular.module("geomeditApp").filter("camelCase",function(){return function(a,b){return a=b?a:"_"+a,a.replace(/_(.)/g,function(a,b){return b.toUpperCase()})}}),angular.module("geomeditApp").service("boardUI",["model","eventHandler","select",function(a,b,c){function d(a,b,c){return Math.abs(a-b)<JXG.def(c,1)}this.initBoard=function(c){JXG.Options.axis=JXG.deepCopy(JXG.Options.axis,a.initOptions.axis),a.board=JXG.JSXGraph.initBoard(c,a.initAttr),a.board.moveOrigin(a.board.canvasWidth/2,a.board.canvasHeight/2),a.board.options=JXG.deepCopy(a.board.options,a.initOptions),b.registerHandlers()},this.freeBoard=function(){var d;return a.board&&(d=a.board.containerObj.id,b.unregisterHandlers(),a.propObj=null,c.resetSelection(),JXG.JSXGraph.freeBoard(a.board),a.board=null),d},this.resizeBoard=function(b,c){if(a.board&&(!d(a.board.canvasWidth,b)||!d(a.board.canvasHeight,c))){var e=d(a.board.origin.scrCoords[1],a.board.canvasWidth/2),f=d(a.board.origin.scrCoords[2],a.board.canvasHeight/2);a.board.resizeContainer(b,c,!1,!0),a.board.applyZoom(),(e||f)&&a.board.moveOrigin(e?a.board.canvasWidth/2:a.board.origin.scrCoords[1],f?a.board.canvasHeight/2:a.board.origin.scrCoords[2])}},this.zooms={zoomDefault:function(){return a.board.moveOrigin(a.board.canvasWidth/2,a.board.canvasHeight/2),a.board.zoom100()},zoomIn:function(){return a.board.zoomIn()},zoomOut:function(){return a.board.zoomOut()},clickLeftArrow:function(){return a.board.clickLeftArrow()},clickRightArrow:function(){return a.board.clickRightArrow()},clickUpArrow:function(){return a.board.clickUpArrow()},clickDownArrow:function(){return a.board.clickDownArrow()}}}]),angular.module("geomeditApp").service("loader",["$q","$timeout",function(a,b){this.load=function(){var c=a.defer();return b(function(){c.resolve()},50),c.promise}}]),angular.module("geomeditApp").directive("newBoard",["loader","boardUI",function(a,b){return{link:function(c,d,e){a.load().then(function(){b.initBoard(e.id)})}}}]),angular.module("geomeditApp").service("snap",["model",function(a){function b(b,c){var d=a.board.options.precision.hasPoint;return{coords:b,hits:[],masks:c,snapSize:d,minDist:d,dist:0,snapped:null,glider:null}}function c(){var b=a.drafts.map(function(a){return a.id});return a.snaps.forEach(function(a){a.created&&b.push(a.created.id)}),b}function d(b,c){function d(a){var c=!1;return a.forEach(function(a){c=c||b.draftIDs&&b.draftIDs.indexOf(a)>=0}),c}function e(a){return a.type===JXG.OBJECT_TYPE_AXISPOINT&&JXG.cmpArrays(a.coords.usrCoords,[1,0,0])}b.coords&&a.board&&a.board.objectsList.forEach(function(f){f!==b.created&&a.drafts.indexOf(f)<0&&!d(f.parents)&&(f.visProp.visible||e(f))&&c(f)})}function e(a){function b(a){return a===JXG.OBJECT_CLASS_LINE||a===JXG.OBJECT_CLASS_CIRCLE||a===JXG.OBJECT_CLASS_CURVE}function c(b){return a.masks&&a.masks.filter&&JXG.isPoint(b)}d(a,function(d){(c(d)||b(d.elementClass))&&d.hasPoint(a.coords.scrCoords[1],a.coords.scrCoords[2])&&a.hits.push(d)})}function f(a){d(a,function(b){JXG.isPoint(b)&&b.hasPoint(a.coords.scrCoords[1],a.coords.scrCoords[2])&&(a.dist=b.coords.distance(JXG.COORDS_BY_SCREEN,a.coords),a.minDist>a.dist&&(a.minDist=a.dist,a.snapped=b))})}function g(a){return a&&a.elementClass===JXG.OBJECT_CLASS_LINE&&!a.straightFirst&&!a.straightLast&&!a.visProp.lastarrow}function h(b){var c;b.hits.forEach(function(d){g(d)&&(c=a.create("midpoint",[d],a.board.options.midpoint),b.dist=c.coords.distance(JXG.COORDS_BY_SCREEN,b.coords),b.minDist>b.dist?(b.minDist=b.dist,b.snapped=d,b.mid&&a.board.removeObject(b.mid),b.mid=c):a.board.removeObject(c))})}function i(b){b.hits.forEach(function(c){var d,e=b.snapSize/2+1;b.masks&&b.masks.gliderFilter&&!b.masks.gliderFilter(c)||(b.glider&&b.glider.slideObject===c?(d=b.glider,d.setPositionDirectly(JXG.COORDS_BY_SCREEN,[b.coords.scrCoords[1],b.coords.scrCoords[2]]),e=1):d=a.create("glider",b.coords.usrCoords.slice(1).concat(c)),b.dist=d.coords.distance(JXG.COORDS_BY_SCREEN,b.coords)+e,b.minDist>b.dist?(b.minDist=b.dist,b.snapped=c,b.glider&&b.glider!==d&&a.board.removeObject(b.glider),b.glider=d):d!==b.glider&&a.board.removeObject(d))})}function j(b){var c,d,e,f=function(a){return a.elementClass===JXG.OBJECT_CLASS_LINE||a.elementClass===JXG.OBJECT_CLASS_CIRCLE};b.hits.forEach(function(g,h){b.hits.forEach(function(i,j){if(h>j&&f(g)&&f(i)){if(c=a.create("intersection",[g,i,0]),JXG.cmpArrays(c.coords.usrCoords,[0,0,0]))return void a.board.removeObject(c);b.dist=c.coords.distance(JXG.COORDS_BY_SCREEN,b.coords),(g.elementClass===JXG.OBJECT_CLASS_CIRCLE||i.elementClass===JXG.OBJECT_CLASS_CIRCLE)&&(d=a.create("intersection",[g,i,1]),e=d.coords.distance(JXG.COORDS_BY_SCREEN,b.coords),b.dist>e?(b.dist=e,a.board.removeObject(c),c=d):a.board.removeObject(d)),b.minDist>b.dist?(b.minDist=b.dist,b.snapped=g,b.cross&&a.board.removeObject(b.cross),b.cross=c):a.board.removeObject(c)}})})}this.snapCoords=function(d,g,k){var l,m=b(d,k),n=a.snap;return JXG.extend(m,{draftIDs:c(),mid:null,cross:null,created:g?g.glider:null,glider:g?g.glider:null}),g&&(g.created&&!g.glider&&a.board.removeObject(g.created),m.masks=k||g.masks),m.masks&&(l=a.board.options.precision.hasPoint,m.snapSize=Math.max(m.snapSize,60),m.minDist=m.snapSize,a.board.options.precision.hasPoint=m.snapSize,n.vertex=n.vertex||m.masks.vertex,n.mid=n.mid||m.masks.mid,n.cross=n.cross||m.masks.cross,n.glider=n.glider||m.masks.glider),m.masks&&JXG.isFunction(m.masks.filter)?(e(m),m.masks.filter(m)):(!a.snap.vertex||m.masks&&!m.masks.vertex||f(m),m.minDist>m.snapSize/4&&(e(m),!a.snap.mid||m.masks&&!m.masks.mid||h(m),!a.snap.cross||m.mid||m.masks&&!m.masks.cross||j(m),!a.snap.glider||m.snapped||m.masks&&!m.masks.glider||i(m))),m.glider&&(m.mid||m.cross||m.glider.slideObject!==m.snapped)&&(a.board.removeObject(m.glider),m.glider=null),m.created=m.mid||m.cross||m.glider||m.created,l&&(a.board.options.precision.hasPoint=l),{coords:(m.created||m.snapped||m).coords,created:m.created,snapped:m.snapped,mid:m.mid,cross:m.cross,glider:m.glider,masks:m.masks,clear:function(){m.created&&(a.board.removeObject(m.created),m.created=null,m.mid=null,m.cross=null,m.glider=null),m.snapped=null},detach:function(){var a=m.created;return m.created=null,m.mid=null,m.cross=null,m.glider=null,m.snapped=null,a}}},this.hitTest=function(c){var d=b(c);return f(d),d.minDist>d.snapSize/4&&(e(d),1===d.hits.length?d.snapped=d.hits[0]:d.hits.length>1&&(i(d),a.board.removeObject(d.glider))),d.snapped},this.isSegment=g}]),angular.module("geomeditApp").service("select",["model",function(a){function b(c){function e(b){g.size=a.uiOptions.highlightSize,g.strokeWidth=0,g.snapToGrid=!1,g.fillColor=a.uiOptions.highlightColor,g.fillOpacity=a.uiOptions.highlightOpacity,f=a.create("point",[function(){return b.usrCoords[1]},function(){return b.usrCoords[2]}],g)}var f,g;switch(g={id:d(),name:"",layer:1,
withLabel:!1,highlighted:!0,strokeOpacity:a.uiOptions.highlightOpacity,strokeColor:a.uiOptions.highlightColor,strokeWidth:(c.getAttribute?c.getAttribute("strokeWidth"):0)+a.uiOptions.highlightSize},c.elementClass){case JXG.OBJECT_CLASS_POINT:e(c.coords);break;case JXG.OBJECT_CLASS_CIRCLE:f=a.create("circle",[c.center,c],g);break;case JXG.OBJECT_CLASS_LINE:g.straightFirst=c.getAttribute("straightFirst"),g.straightLast=c.getAttribute("straightLast"),f=a.create("line",[c.point1,c.point2],g);break;case JXG.OBJECT_CLASS_CURVE:c.type===JXG.OBJECT_TYPE_GRID&&(g.strokeOpacity/=2),c.type===JXG.OBJECT_TYPE_ANGLE||c.type===JXG.OBJECT_TYPE_ARC||c.type===JXG.OBJECT_TYPE_SECTOR?(f=a.create("curve",[c.dataX,c.dataY],g),f.bezierDegree=3,f.prepareUpdate().update().updateRenderer()):f=a.create("curve",JXG.coordsArrayToMatrix(c.points,!0),g)}if(!f)switch(c.type){case JXG.OBJECT_TYPE_POLYGON:f=c.borders.map(function(a){return b(a)});break;case JXG.OBJECT_TYPE_TEXT:e(c.coords);break;case JXG.OBJECT_TYPE_TICKS:f=b(c.line)}return f}var c=1,d=function(){return"_aux"+c++};this.select=function(c,d){d&&this.resetSelection();var e=c?b(c):null,f=function(b){b.highlight=angular.noop,b.reference=c,a.selection.push(b)};e&&(JXG.isArray(e)?e.forEach(f):f(e))},this.resetSelection=function(){for(;a.selection.length>0;)a.board.removeObject(a.selection.pop())},this.highlight=function(b,c){if(c)this.select(b);else if(b!==a.propObj)for(var d=a.selection.length-1;d>=0;d--)a.selection[d].reference===b&&a.board.removeObject(a.selection.splice(d,1)[0])}}]),angular.module("geomeditApp").service("motion",["model","snap",function(a,b){this.startPt=null,this.lastPt=null,this.pt=null,this.dragging=!1,this.updateStartCoords=function(a){this.startPt=this.lastPt=this.pt=this.getEventCoords(a)},this.updateCoords=function(a){this.pt=this.getEventCoords(a)},this.clear=function(){this.clearDrafts(),this.clearDraftCoords()},this.clearDraftCoords=function(){for(;a.snaps.length>0;)a.snaps.pop().clear();this.startPt=this.lastPt=this.pt=null},this.clearDrafts=function(){for(;a.drafts.length>0;)a.board.removeObject(a.drafts.pop())},this.getDraftCoords=function(b){return b=JXG.def(b,-1),b=0>b?a.snaps.length+b:b,a.snaps[b]},this.setDraftCoords=function(c,d){c=0>c?a.snaps.length+c:c,a.snaps[c]=b.snapCoords(this.pt,a.snaps[c],d)},this.updateDraftCoords=function(){var c=a.snaps.length-1;a.snaps[c]=b.snapCoords(this.pt,a.snaps[c])},this.addDraftCoords=function(c){var d=b.snapCoords(this.pt,null,c);return a.snaps.push(d),d},this.draftCoordsCount=function(){return a.snaps.length},this.hasDraftCoords=function(){return a.snaps.length>0},this.lastDraftCoordsIsNew=function(){var b=0;return a.snaps.length>1&&(b=this.getDraftCoords(-1).coords.distance(JXG.COORDS_BY_SCREEN,this.getDraftCoords(-2).coords)),b>5},this.createDraftPoint=function(b){function c(){var c=Math.min(b,a.snaps.length-1),d=c>=0&&a.snaps[c].snapped,e=d?a.snaps[c].created:null;h.setAttribute({size:d?j:i.size,fillopacity:e&&a.snaps[c].glider?.1:d?.3:1,strokecolor:e?e.visProp.strokecolor:i.strokecolor})}var d=function(a){return a?a.point2?a.point2.coords:a.coords:null},e=function(c){var e=Math.min(b,a.snaps.length-1),f=0>e?null:a.snaps[e];return f?(d(f.created)||f.coords).usrCoords[c]:0},f=function(){return e(1)},g=function(){return e(2)},h=a.create("point",[f,g],{withLabel:!1}),i=JXG.deepCopy({},h.visProp),j=Math.max(a.board.options.precision.hasPoint,i.size+4);return h.coords.on("update",c,h),c(),a.drafts.push(h),h},this.createDraftPoints=function(a){var b=this;return a=JXG.isArray(a)?a:Array.prototype.slice.call(arguments),a.map(function(a){return b.createDraftPoint(a)})},this.createPoint=function(b,c,d){var e=JXG.isObject(b)?b:a.snaps[b];if(c&&JXG.isPoint(e.snapped)&&!e.created)return e.snapped;var f=e.detach()||!e.snapped&&a.create("point",e.coords.usrCoords.slice(1),d);return f&&a.pendings&&a.pendings.push(f),f},this.createPoints=function(b){var c=this,d=a.snaps.map(function(a){return c.createPoint(a,!0,b)});return a.snaps.length=0,d},this.submit=function(b){var c,d=this;try{d.clearDrafts(),a.pendings=[],c=b(),c&&(JXG.isArray(c)?c.forEach(function(b){a.pendings.indexOf(b)<0&&a.pendings.push(b),a.propObj=b}):(a.pendings.indexOf(c)<0&&a.pendings.push(c),a.propObj=c))}catch(e){for(;a.pendings.length>0;)a.board.removeObject(a.pendings.pop());throw e}finally{a.pendings=null,d.clearDraftCoords()}},this.isSegment=b.isSegment,this.getMouseCoords=function(b){var c=JXG.getPosition(b),d=a.board.getCoordsTopLeftCorner(),e=c[0]-d[0],f=c[1]-d[1];return new JXG.Coords(JXG.COORDS_BY_SCREEN,[e,f],a.board)},this.getTouchCoords=function(b,c){var d=JXG.getPosition(b,c),e=a.board.getCoordsTopLeftCorner(),f=d[0]-e[0],g=d[1]-e[1];return new JXG.Coords(JXG.COORDS_BY_SCREEN,[f,g],a.board)},this.getEventCoords=function(a){return a[JXG.touchProperty]?this.getTouchCoords(a,-1):this.getMouseCoords(a)}}]),angular.module("geomeditApp").service("eventHandler",["model","motion",function(a,b){function c(a){a.preventDefault()}function d(b){b?a.board.options.precision.hasPoint=a.board.options.precision.touch:a.snap.project&&(a.board.options.precision.hasPoint=a.board.options.precision.touch/2)}var e,f,g;this.touchMode=!1,this.customDownHandlers=[],this.customMoveHandlers=[],this.registerHandlers=function(){JXG.supportsPointerEvents()?(window.navigator.pointerEnabled?(e="pointerdown",f="pointerup",g="pointermove"):(e="MSPointerDown",f="MSPointerUp",g="MSPointerMove"),JXG.Options.device="msie"):JXG.isTouchDevice()||JXG.isFirefoxOS()?(e="touchstart",f="touchend",g="touchmove",JXG.Options.device="tablet"):(e="mousedown",f="mouseup",g="mousemove",JXG.Options.device="pc"),JXG.supportsPointerEvents()?this.addPointerHandlers():(this.addMouseHandlers(),this.addTouchHandlers()),JXG.addEvent(a.board.containerObj,e,this.downEventHandler,this),JXG.addEvent(a.board.containerObj,g,this.moveEventHandler,this),JXG.addEvent(a.board.containerObj,f,this.upEventHandler,this)},this.unregisterHandlers=function(){this.removePointerHandlers(),this.removeMouseHandlers(),this.removeTouchHandlers(),JXG.removeEvent(a.board.containerObj,e,this.downEventHandler,this),JXG.removeEvent(a.board.containerObj,g,this.moveEventHandler,this),JXG.removeEvent(a.board.containerObj,f,this.upEventHandler,this),b.clear()},this.addPointerHandlers=function(){!a.board.hasPointerHandlers&&JXG.isBrowser&&(JXG.addEvent(a.board.containerObj,g,a.board.pointerMoveListener,a.board),a.board.containerObj.addEventListener("MSHoldVisual",c,!1),a.board.containerObj.addEventListener("contextmenu",c,!1),a.board.containerObj.addEventListener("selectstart",c,!1),this.jxgDownHandler=function(){return a.board.pointerDownListener.apply(a.board,arguments)},a.board.hasPointerHandlers=!0,this.touchMode=!0)},this.addMouseHandlers=function(){!a.board.hasMouseHandlers&&JXG.isBrowser&&(JXG.addEvent(a.board.containerObj,"mousemove",a.board.mouseMoveListener,a.board),a.board.containerObj.addEventListener("contextmenu",c,!1),this.jxgDownHandler=function(){a.board.mouseDownListener.apply(a.board,arguments)},a.board.hasMouseHandlers=!0)},this.addTouchHandlers=function(){!a.board.hasTouchHandlers&&JXG.isBrowser&&(JXG.addEvent(a.board.containerObj,"touchmove",a.board.touchMoveListener,a.board),a.board.hasTouchHandlers=!0)},this.removePointerHandlers=function(){a.board.hasPointerHandlers&&(JXG.removeEvent(a.board.containerObj,g,a.board.pointerMoveListener,a.board),a.board.containerObj.removeEventListener("MSHoldVisual",c,!1),a.board.containerObj.removeEventListener("contextmenu",c,!1),a.board.containerObj.removeEventListener("selectstart",c,!1),a.board.hasPointerHandlers=!1)},this.removeMouseHandlers=function(){a.board.hasMouseHandlers&&(JXG.removeEvent(a.board.containerObj,"mousemove",a.board.mouseMoveListener,a.board),a.board.containerObj.removeEventListener("contextmenu",c,!1),a.board.hasMouseHandlers=!1)},this.removeTouchHandlers=function(){a.board.hasTouchHandlers&&(JXG.removeEvent(a.board.containerObj,"touchmove",a.board.touchMoveListener,a.board),a.board.hasTouchHandlers=!1)},this.downEventHandler=function(c){a.board.hasMouseHandlers&&c[JXG.touchProperty]&&(this.removeMouseHandlers(),this.jxgDownHandler=function(){a.board.touchStartListener.apply(a.board,arguments)},a.board.hasMouseHandlers=!1,this.touchMode=!0),d(this.touchMode),b.updateStartCoords(c),b.dragging=!0,a.command?((a.command.downHandler||angular.noop)(),a.board.update()):a.draggable&&(this.jxgDownHandler||angular.noop)(c),angular.element("body").click(),this.customDownHandlers.forEach(function(a){a(c)})},this.moveEventHandler=function(c){b.dragging&&(d(this.touchMode),b.updateCoords(c),this.customMoveHandlers.forEach(function(a){a(c)}),a.command&&(a.command.moveHandler?a.command.moveHandler():b.hasDraftCoords()&&b.updateDraftCoords(),a.board.update(),b.lastPt=b.pt))},this.upEventHandler=function(c){b.dragging&&(b.updateCoords(c),b.dragging=!1,a.command&&((a.command.upHandler||angular.noop)(),a.board.update()))}}]),angular.module("geomeditApp").controller("ToolboxCtrl",["$scope",function(a){a.sidebar.go("toolbox",!0)}]),angular.module("geomeditApp").controller("CmdContextCtrl",[function(){}]),angular.module("geomeditApp").service("commands",["model","motion","select",function(a,b,c){var d=0,e=null;this.groups=function(){return d!==a.commands.length&&(d=a.commands.length,e=a.cmdGroups.map(function(a){return{name:a.name,commands:a.commands.map(function(a){return a.id})}})),e},this.active=function(){return a.command?a.command.id:""},this.cancel=function(){var c=!!a.command;return a.command&&((a.command.cancelled||angular.noop)(),a.command=null,b.clear()),c},this.start=function(b,c){c||this.resetSelection();var d=this.cancel();if(a.command=a.findCommand(b),a.command){var e=(a.command.inited||angular.noop)();"boolean"!=typeof e||e?d=!0:a.command=null}return d},this.resetSelection=function(){a.propObj=null,c.resetSelection()}}]),angular.module("geomeditApp").service("cmdAux",["model","motion",function(a,b){this.addPointCommand=function(c,d,e){function f(){b.setDraftCoords(0,e),b.createDraftPoint(0)}function g(){b.submit(function(){var a=b.getDraftCoords().created;return(!e||JXG.isPoint(a))&&b.createPoint(0)||JXG.isFunction(e.up)&&e.up()})}a.addCommand(c||"point",{id:d,downHandler:f,upHandler:g})},this.perpendicularFilter=function(b){var c;b.hits.forEach(function(d){a.drafts[0]&&d.elementClass===JXG.OBJECT_CLASS_LINE&&(c=a.create("perpendicularPoint",[a.drafts[0],d]),b.dist=c.coords.distance(JXG.COORDS_BY_SCREEN,b.coords),b.minDist>b.dist?(b.minDist=b.dist,b.snapped=d,b.created&&a.board.removeObject(b.created),b.created=c):a.board.removeObject(c))})},this.addCommandSnapSecond=function(c,d,e,f){function g(){b.hasDraftCoords()?b.updateDraftCoords():(b.addDraftCoords(),b.addDraftCoords({filter:e}),a.drafts.push(a.create("segment",b.createDraftPoints(0,1))))}function h(){b.lastDraftCoordsIsNew()&&b.submit(function(){var c=b.getDraftCoords();if(c.snapped){if(f)return f(b.createPoint(0,!0),c);var d=[b.createPoint(0,!0),c.snapped];return"mirrorpoint"===c.created.elType&&d.reverse(),a.create(c.created.elType,d)}})}a.addCommand(c||"point",{id:d,downHandler:g,upHandler:h})},this.addLineCommand=function(c,d,e,f){function g(){b.hasDraftCoords()?b.updateDraftCoords():(b.addDraftCoords(),b.addDraftCoords(),a.drafts.push(a.create(e,b.createDraftPoints(0,1),f)))}function h(){b.lastDraftCoordsIsNew()&&b.submit(function(){return a.create(e,b.createPoints(),f)})}a.addCommand(c||"line",{id:d,downHandler:g,upHandler:h})},this.addCommandSnapFirst=function(c,d,e,f){function g(){b.hasDraftCoords()?b.updateDraftCoords():b.addDraftCoords(e).snapped?(b.addDraftCoords(),a.drafts.push(f(b.getDraftCoords(0),b.createDraftPoint(1)))):b.clearDraftCoords()}function h(){b.lastDraftCoordsIsNew()&&b.submit(function(){return f(b.getDraftCoords(0),b.createPoint(1,!0))})}a.addCommand(c||"line",{id:d,downHandler:g,upHandler:h})},this.addCommand3p=function(c,d,e,f){function g(){b.hasDraftCoords()?b.lastDraftCoordsIsNew()?(b.addDraftCoords(),a.drafts.push(f(a.create(e,i),i))):b.updateDraftCoords():(b.addDraftCoords(),b.addDraftCoords(),i=b.createDraftPoints(0,1,2))}function h(){3===b.draftCoordsCount()&&b.lastDraftCoordsIsNew()&&b.submit(function(){return i=b.createPoints(),f(a.create(e,i),i)})}var i;f=f||function(a){return a},a.addCommand(c||"circle",{id:d,downHandler:g,upHandler:h})},this.addPolygonCommand=function(c,d,e,f,g){function h(){b.hasDraftCoords()?b.lastDraftCoordsIsNew()?(b.addDraftCoords(),b.lastDraftCoordsIsNew()&&b.draftCoordsCount()<e&&b.addDraftCoords()):b.updateDraftCoords():(b.addDraftCoords(),b.addDraftCoords(),a.drafts.push(a.create("polygon",b.createDraftPoints(f))))}function i(){b.draftCoordsCount()===e&&b.lastDraftCoordsIsNew()&&b.submit(function(){return a.create("polygon",b.createPoints())})}a.addCommand(c||"polygon",{id:d,downHandler:h,upHandler:i,cancelled:g})}}]),angular.module("geomeditApp").run(["model","motion","cmdAux",function(a,b,c){c.addPointCommand("","point"),c.addPointCommand("","midpoint",{mid:!0,up:function(){var c=b.addDraftCoords({glider:!0});return b.isSegment(c.snapped)?a.create("midpoint",[c.snapped],a.board.options.midpoint):void 0}}),c.addPointCommand("","intersection",{cross:!0}),c.addPointCommand("","glider",{glider:!0}),c.addCommandSnapSecond("","perpPoint",c.perpendicularFilter),c.addCommandSnapSecond("","reflection",function(b){var c,d,e,f=function(a,b,c){return(a.coords.scrCoords[c]+b.coords.scrCoords[c])/2},g=function(c){return d=f(c,a.drafts[0],1)-b.coords.scrCoords[1],e=f(c,a.drafts[0],2)-b.coords.scrCoords[2],Math.sqrt(d*d+e*e)};b.hits.forEach(function(d){a.drafts[0]&&d.elementClass===JXG.OBJECT_CLASS_LINE?(c=a.create("reflection",[a.drafts[0],d]),b.dist=g(c),b.minDist>b.dist?(b.minDist=b.dist,b.snapped=d,b.created&&a.board.removeObject(b.created),b.created=c):a.board.removeObject(c)):a.drafts[0]&&JXG.isPoint(d)&&(c=a.create("mirrorPoint",[d,a.drafts[0]]),b.dist=g(c),b.minDist>b.dist?(b.minDist=b.dist,b.snapped=d,b.created&&a.board.removeObject(b.created),b.created=c):a.board.removeObject(c))})}),c.addCommand3p("point","in_center","incenter")}]),angular.module("geomeditApp").run(["model","motion","cmdAux",function(a,b,c){c.addLineCommand("","segment","segment"),c.addLineCommand("","ray","line",{straightFirst:!1}),c.addLineCommand("","line","line"),c.addCommandSnapFirst("","parallel",{glider:!0,gliderFilter:function(a){return a.elementClass===JXG.OBJECT_CLASS_LINE}},function(b,c){return a.create("parallel",[b.snapped,c])}),c.addCommandSnapSecond("line","perpSegment",c.perpendicularFilter,function(b,c){return a.create("perpendicularSegment",[c.snapped,b])}),c.addCommandSnapSecond("line","perpLine",c.perpendicularFilter,function(b,c){return a.create("perpendicular",[c.snapped,b])}),c.addCommand3p("line","bisector","bisector")}]),angular.module("geomeditApp").run(["model","motion","cmdAux",function(a,b,c){c.addPolygonCommand("","triangle",3,[0,1,2]),c.addPolygonCommand("","quadrangle",4,[0,1,2,3]),c.addCommand3p("polygon","parallelogram","parallelpoint",function(b,c){return b.setAttribute({visible:!1}),[b,a.create("polygon",[c[0],c[1],b,c[2]])]});var d,e=[];for(d=0;20>d;d++)e[d]=d;c.addPolygonCommand("","polygon",e.length,e,function(){for(;b.draftCoordsCount()>1&&!b.lastDraftCoordsIsNew();)a.snaps.pop().clear();b.draftCoordsCount()>2&&b.submit(function(){return a.create("polygon",b.createPoints())})})}]),angular.module("geomeditApp").run(["model","motion","cmdAux",function(a,b,c){c.addCommand3p("","circle3p","circumCircle"),c.addCommand3p("","in_circle","incircle"),function(){function c(){b.hasDraftCoords()?b.updateDraftCoords():(b.addDraftCoords(),b.addDraftCoords(),a.drafts.push(a.create("circle",b.createDraftPoints(0,1))))}function d(){b.lastDraftCoordsIsNew()&&b.submit(function(){return a.create("circle",b.createPoints())})}a.addCommand("circle",{id:"circle2p",downHandler:c,upHandler:d})}()}]);