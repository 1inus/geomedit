angular.module("geomeditApp",["ui.router","ngAnimate","mgcrea.ngStrap","pascalprecht.translate","LocalStorageModule"]).config(["$stateProvider","$urlRouterProvider","localStorageServiceProvider",function(a,b,c){"use strict";a.state("home",{url:"/",templateUrl:"views/home.html"}).state("blog",{url:"/blog",templateUrl:"views/home.html"}).state("sketch",{url:"/sketch",templateUrl:"views/sketch.html",controller:"MainCtrl"}).state("sketch.toolbox",{url:"/tool",templateUrl:"views/toolbox.html",controller:"ToolboxCtrl"}).state("sketch.properties",{url:"/prop",templateUrl:"views/properties.html",controller:"PropCtrl"}),b.otherwise("/sketch"),c.setPrefix("geomedit"),JXG.extend(JXG,{isFalse:function(a){return"boolean"==typeof a&&!a}})}]),angular.module("geomeditApp").config(["$translateProvider",function(a){"use strict";var b=navigator?navigator.language||navigator.userLanguage:null;a.translations("en",{Languages:"UI language",ShowTooltip:"Show tooltip",SnapOptions:"Snapping options",SnapPoint:"Snap to point",SnapMid:"Snap to new midpoint",SnapCross:"Snap to new intersection",SnapGlider:"Snap to edge",ProjectMode:"Large screen projection",ProjectName:"Geometry Online",ProjectDesc:"Dynamic Mathematics with JSXGraph",Blog:"Blog",StartSketch:"Start for sketch",Loading:"Loading...",Cmd_:"Select",CmdPoint:"Point",CmdMidpoint:"Midpoint",CmdIntersection:"Intersection",CmdGlider:"Glider point",CmdPerpPoint:"Perpendicular point",CmdReflection:"Reflected point",CmdInCenter:"Inscribed center",CmdSegment:"Segment",CmdRay:"Half-line",CmdLine:"Infinite line",CmdParallel:"Parallel line",CmdPerpSegment:"Perpendicular segment",CmdPerpLine:"Perpendicular line",CmdBisector:"Angle bisector",CmdTriangle:"Triangle",CmdQuadrangle:"Quadrangle",CmdPolygon:"Polygon",CmdParallelogram:"Parallelogram",CmdCircle2p:"Circle with center",CmdCircle3p:"Circle through 3 points",CmdInCircle:"Inscribed circle",TipPoint:"Click or drag to a position",TipMidpoint:"Click or drag around a segment",TipIntersection:"Click or drag around two shapes",TipGlider:"Click or drag on a shape",TipClkDragFromPt:"Click or drag from a position",TipClkDragToPtLn:"Click or drag to a line or point",TipDragToPtLn:"Drag to a line or point",TipClkDragStart:"Click or drag from the start position",TipDragToEnd:"Drag to the end position",TipClkDragToEnd:"Click or drag to the end position",TipClkDragLine:"Click or drag from a line",TipDragToLine:"Drag to a line",TipClkDragToLine:"Click or drag to a line",Tip3triangle:"Click or drag from a position, or click a triangle",TipDragToP2:"Drag to the second position",TipClkDragToP2:"Click or drag to the second position",TipDragToP3:"Drag to the third position",TipClkDragToP3:"Click or drag to the third position",TipDragToPn:"Drag to the next position",TipClkDragToPn:"Drag to the next, cancel tool to complete",TipCircle2p:"Click or drag from the center",TipDragToRadius:"Drag to a position on circle",TipClkDragToRadius:"Click or drag to a position on circle",SelectShape:"Please select a shape.",SelectOption:"Select",FaceCircle:"Circle",FaceCross:"Cross",FacePlus:"Plus",FaceDiamond:"Diamond",FaceSquare:"Square",FaceUpTriangle:"Up triangle",FaceDownTriangle:"Down triangle",FaceLeftTriangle:"Left triangle",FaceRightTriangle:"Right triangle",PosLeft:"Left",PosRight:"Right",PosCenter:"Center",SolidLine:"Solid line",DottedLine:"Dotted line",SmallDashes:"Small dashes",MediumDashes:"Medium dashes",BigDashes:"Big dashes",LargeGaps:"Large gaps -.-",SmallGaps:"Small gaps -.-",PropLabel:"Label",PropText:"Text",PropFontSize:"Text size",PropTextColor:"Text color",PropFixed:"Fixed",PropTrace:"Trace",PropRange:"Range",PropSnapWidth:"Snap width",PropFace:"Face",PropSize:"Size",PropPosition:"Position",PropOffset:"Offset",PropDash:"Dash",PropStrokeWidth:"Stroke width",PropStrokeColor:"Stroke color",PropStrokeOpacity:"Stroke opacity",PropFillColor:"Fill color",PropFillOpacity:"Fill opacity",PropColor:"Color",PropOpacity:"Opacity",PropHideColor:"Hide color bar",PropExpandColor:"Show color bar",PropInnerPoints:"Drag inner area",PropCoords:"Coords",PropSnapToGrid:"Snap to a grid",PropSnapToPoints:"Snap to the nearest point",PropZoomSize:"Changes on zoom events",PropLineEndings:"Line endings",PropRadius:"Radius",PropCenterVisible:"Show center",PropFunctionTerm:"Function term",PropBoard:"Drawing area",PropDraggable:"Can drag objects",PropIgnoreLabels:"Can drag labels",PropGrid:"Grid",PropGridCell:"Grid cell",PropGridLT:"Left top",PropGridRB:"Right bottom",PropAxis:"Axis",PropOrigin:"Origin",PropUnits:"Units",PropDrawLabels:"Draw labels",PropDrawZero:"Zero tick",PropInsertTicks:"Auto insert ticks",PropScaleSymbol:"Unit of labels",PropTicksDistance:"Ticks distance",PropTicksDistances:"Ticks dist",PropMajorHeight:"Infinite tick line",PropMinorTicks:"Minor ticks count",ShowSidebar:"Show sidebar",HideSidebar:"Hide sidebar",CancelCmd:"Cancel the current tool",Toolbox:"Toolbox view",Properties:"Properties view",ZoomIn:"Zoom In",ZoomOut:"Zoom Out",ZoomDefault:"Default Zoom",ShowNavigators:"Show the navigation bar",HideNavigators:"Hide the navigation bar",PanUp:"Pan Up",PanDown:"Pan Down",PanLeft:"Pan Left",PanRight:"Pan Right",ShowAllObjects:"List all objects",HideObject:"Hide object",ShowObject:"Show object",HideLabel:"Hide label",ShowLabel:"Show label",ArrowLast:"Arrow head at the second point",ArrowFirst:"Arrow head at the first point",RestrictLast:"Stop at the second point",RestrictFirst:"Stop at the first point",RecreateBoard:"Reset",Undo:"Undo",Redo:"Redo",Options:"Options",Home:"Home"}).translations("cn",{Languages:"界面语言",ShowTooltip:"显示工具提示",SnapOptions:"捕捉选项",SnapPoint:"允许捕捉点",SnapMid:"捕捉新的中点",SnapCross:"捕捉新的交点",SnapGlider:"允许捕捉线上点",ProjectMode:"大屏投影模式",ProjectName:"几何绘图",ProjectDesc:"基于 JSXGraph 的在线动态几何编辑平台",Blog:"博客",StartSketch:"开始绘图",Loading:"正在加载...",Cmd_:"选择",Point:"点",CmdPoint:"点",CmdMidpoint:"中点",CmdIntersection:"交点",CmdGlider:"线上点",CmdPerpPoint:"垂足",CmdReflection:"对称点",CmdInCenter:"三点内心",Line:"直线",CmdSegment:"线段",CmdRay:"射线",CmdLine:"直线",CmdParallel:"平行线",CmdPerpSegment:"垂线段",CmdPerpLine:"垂线",CmdBisector:"角平分线",Polygon:"多边形",CmdTriangle:"三角形",CmdQuadrangle:"四边形",CmdPolygon:"多边形",CmdParallelogram:"平行四边形",Circle:"圆",CmdCircle2p:"圆心圆",CmdCircle3p:"过三点画圆",CmdInCircle:"三点内切圆",TipPoint:"点击或拖动到一个位置",TipMidpoint:"在线段附近点击或拖动",TipIntersection:"在两个图形相交附近点击或拖动",TipGlider:"在一个图形上点击或拖动",TipClkDragFromPt:"点击或从一个位置拖动",TipClkDragToPtLn:"点击或拖动到一个直线或点",TipDragToPtLn:"拖动到一个直线或点",TipClkDragStart:"点击起始位置或从该点拖动",TipDragToEnd:"拖动到终点位置",TipClkDragToEnd:"点击终点位置或拖动到该点",TipClkDragLine:"点击一个直线或从该直线拖动",TipDragToLine:"拖动到一个直线",TipClkDragToLine:"点击一个直线或拖动到该直线",Tip3triangle:"点击或从一个位置拖动，或点击一个三角形",TipDragToP2:"拖动到第二个点的位置",TipClkDragToP2:"点击第二个点的位置或拖动到该点",TipDragToP3:"拖动到第三个点的位置",TipClkDragToP3:"点击第三个点的位置或拖动到该点",TipDragToPn:"拖动到下一个顶点的位置",TipClkDragToPn:"点击或拖动到下一点，取消工具可完成操作",TipCircle2p:"点击圆心位置或从该点拖动",TipDragToRadius:"拖动到一点确定半径",TipClkDragToRadius:"点击或拖动到圆周上的位置",SelectShape:"请选择一个图形",SelectOption:"选择",FaceCircle:"圆点",FaceCross:"叉号",FacePlus:"加号",FaceDiamond:"菱形",FaceSquare:"方形",FaceUpTriangle:"上三角形",FaceDownTriangle:"下三角形",FaceLeftTriangle:"左三角形",FaceRightTriangle:"右三角形",PosLeft:"左侧",PosRight:"右侧",PosCenter:"中间",SolidLine:"实线",DottedLine:"点线",SmallDashes:"短虚线",MediumDashes:"中虚线",BigDashes:"长虚线",LargeGaps:"大间距点划线",SmallGaps:"小间距点划线",PropLabel:"标签",PropText:"文字",PropFontSize:"文字大小",PropTextColor:"文字颜色",PropFixed:"固定",PropTrace:"跟踪位置",PropRange:"变化范围",PropSnapWidth:"捕捉宽度",PropFace:"外观",PropSize:"大小",PropPosition:"位置",PropOffset:"偏移",PropDash:"虚线",PropStrokeWidth:"线宽",PropStrokeColor:"线条颜色",PropStrokeOpacity:"线条不透明度",PropFillColor:"填充颜色",PropFillOpacity:"填充不透明度",PropColor:"颜色",PropOpacity:"不透明度",PropHideColor:"收起颜色条",PropExpandColor:"展开颜色条",PropCoords:"坐标",PropSnapToGrid:"捕捉到网格点",PropSnapToPoints:"捕捉到附近点",PropZoomSize:"放缩时大小自适应",PropLineEndings:"线端类型",PropInnerPoints:"可拖动内部区域",PropRadius:"半径",PropCenterVisible:"显示圆心",PropFunctionTerm:"函数式",PropBoard:"绘图区",PropDraggable:"允许拖动图形",PropIgnoreLabels:"允许拖动标签",PropGrid:"网格",PropGridCell:"网格尺寸",PropGridLT:"左上角",PropGridRB:"右下角",PropAxis:"坐标轴",PropOrigin:"原点",PropUnits:"单位",PropDrawLabels:"显示刻度文字",PropDrawZero:"显示零刻度",PropInsertTicks:"自动插入刻度",PropScaleSymbol:"刻度单位",PropTicksDistance:"刻度线距离",PropTicksDistances:"刻度线距离",PropMajorHeight:"主刻度线延长",PropMinorTicks:"小刻度数",ShowSidebar:"展开操作面板",HideSidebar:"收起操作面板",CancelCmd:"取消当前工具",Toolbox:"工具",Properties:"属性",ZoomIn:"放大",ZoomOut:"缩小",ZoomDefault:"默认比例",ShowNavigators:"显示导航条",HideNavigators:"隐藏导航条",PanUp:"向上平移",PanDown:"向下平移",PanLeft:"向左平移",PanRight:"向右平移",ShowAllObjects:"列出所有图形",HideObject:"隐藏本图形",ShowObject:"显示本图形",HideLabel:"隐藏标签",ShowLabel:"显示标签",ArrowLast:"终点有箭头",ArrowFirst:"起点有箭头",RestrictLast:"终点不延长",RestrictFirst:"起点不延长",RecreateBoard:"重置",Undo:"撤销",Redo:"重做",Options:"选项",Home:"首页"}).preferredLanguage(b&&b.toLowerCase().indexOf("cn")>=0?"cn":"en").useSanitizeValueStrategy(null)}]),angular.module("geomeditApp").controller("RootCtrl",["$scope","$state","$translate","localStorageService",function(a,b,c,d){"use strict";c.use(d.get("lang")),a.switchLanguage=function(a){c.use(a),d.set("lang",a)}}]),angular.module("geomeditApp").factory("model",function(){"use strict";return{snap:{point:!0,mid:!0,cross:!0,glider:!0,project:!1,items:[{type:"switch",id:"point",title:"SnapPoint"},{type:"switch",id:"mid",title:"SnapMid"},{type:"switch",id:"cross",title:"SnapCross"},{type:"switch",id:"glider",title:"SnapGlider"},{type:"switch",id:"project",title:"ProjectMode"}]},initAttr:{originX:100,originY:400,unitX:20,unitY:20,keepAspectRatio:!0,axis:!0,grid:!0,showCopyright:!1,showNavigation:!1,registerEvents:!1},initOptions:{board:{ignoreLabels:!1},axis:{label:{position:"rt",offset:[-10,-10]},ticks:{insertTicks:!1,ticksDistance:5,majorHeight:30}},label:{fixed:!1},precision:{hasPoint:8},point:{withLabel:!1},midpoint:{size:4,face:"^",fillColor:"none"},intersection:{face:"x"},perpendicularPoint:{face:"[]",fillColor:"#00dd00",strokeColor:"#00dd00"},perpendicularsegment:{point:{face:"[]",fillColor:"#00dd00",strokeColor:"#00dd00"}},glider:{face:"diamond",fillColor:"#00dd00",strokeColor:"#00dd00"},polygon:{hasInnerPoints:!0},regularPolygon:{hasInnerPoints:!0}},uiOptions:{highlightColor:"#ddd",highlightSize:12,highlightOpacity:.6},board:null,drafts:[],snaps:[],pendings:null,propObj:null,selection:[],commands:[],cmdGroups:[],command:null,context:{},draggable:!0,create:function(a,b,c){return this.board.create(a,b,c)},findCommand:function(a){var b,c;for(b=0,c=this.commands.length;c>b;b++)if(this.commands[b].id===a)return this.commands[b];return null},findCommandGroup:function(a){var b,c;for(b=0,c=this.cmdGroups.length;c>b;b++)if(this.cmdGroups[b].name===a)return this.cmdGroups[b];return null},addCommand:function(a,b,c){var d=b&&JXG.isString(b),e=a&&JXG.isString(a),f=this.findCommand(b);if(d&&e)if(c.id=b,f)JXG.extend(f,c);else{this.commands.push(c);var g=this.findCommandGroup(a);g||(g={name:a,commands:[]},this.cmdGroups.push(g)),g.commands.push(c)}}}}),angular.module("geomeditApp").controller("MainCtrl",["$scope","$state","header","sidebar","commands","properties","model","boardUI",function(a,b,c,d,e,f,g,h){"use strict";a.leftButtons=c.leftButtons,a.rightButtons=c.rightButtons,a.toolbox=e,a.snap=g.snap,a.zooms=h.zooms,c.homeBtn.click=function(){b.go("home")},a.tooltip={show:!JXG.isApple()},a.sidebar=d,b.get("sketch").onExit=function(){h.freeBoard()},a.recreateBoard=function(){h.initBoard(h.freeBoard()),a.$applyAsync()};var i=b.get("sketch.properties");i.onEnter=f.onEnter,i.onExit=f.onExit,d.showDefaultView()}]),angular.module("geomeditApp").factory("sidebar",["$state","$timeout","localStorageService",function(a,b,c){"use strict";return{views:[{state:"toolbox",icon:"wrench"},{state:"properties",icon:"sliders"}],state:"",hidden:c.get("sidebarHidden"),go:function(b,d){this.state!==b&&(this.state=b,d||(a.go("sketch."+b),c.set("sideView",b)))},toggleVisible:function(){this.hidden=!this.hidden,c.set("sidebarHidden",this.hidden)},showDefaultView:function(){var a=this;this.state="",b(function(){a.state||a.go(c.get("sideView")||"toolbox")},50)}}}]),angular.module("geomeditApp").service("header",[function(){"use strict";var a=!1,b=!1,c={tooltip:"Undo",icon:"reply",disabled:function(){return!a},click:function(){this.disabled()||(a=!a)}},d={tooltip:"Redo",icon:"share",disabled:function(){return!b},click:function(){this.disabled()||(b=!b)}},e={tooltip:"Options",icon:"cog",popover:"options",click:function(a){a.showOptionsPopover()}};this.homeBtn={tooltip:"Home",icon:"home"},this.leftButtons=[c,d],this.rightButtons=[e,this.homeBtn]}]),angular.module("geomeditApp").directive("edPopover",["$popover",function(a){"use strict";function b(b,c,d){return a(c,{contentTemplate:d,html:!0,trigger:"manual",placement:"bottom",autoClose:!0,scope:b})}return{link:function(a,c,d){if("options"===d.edPopover){var e=b(a,c,"views/options.html");a.showOptionsPopover=function(){e.show()}}}}}]),angular.module("geomeditApp").directive("leftExpandable",["boardUI",function(a){"use strict";return{link:function(b,c){function d(){return"absolute"===c.css("position")}function e(b){d()?(c.css("bottom",b?0:f+1),c.css("margin-left",0)):(c.css("bottom","auto"),c.css("margin-left",b?0:f+1)),b&&a.resizeBoard(c.width(),c.height())}var f=parseInt(c.css("margin-left"))||parseInt(c.css("bottom"));b.$watch("sidebar.hidden",e),b.$watchGroup([function(){return c.width()},function(){return c.height()}],function(c){b.sidebar.hidden||a.resizeBoard(c[0],c[1])});var g=window.onresize||angular.noop;window.onresize=function(){window.DeviceOrientationEvent&&e(b.sidebar.hidden),g(),a.resizeBoard(c.width(),c.height())}}}}]),angular.module("geomeditApp").factory("properties",["model","eventHandler","commands","select",function(a,b,c,d){"use strict";function e(a,b,c,d){var e=["label","fontSize","textColor","fixed","trace"];return"board"===a?e=["draggable","ignoreLabels","grid","gridCell","ticksDistances","axis","origin","units"]:"slider"===c?e=["range","snapWidth","face","size","label","fontSize","textColor","strokeWidth","strokeColor","strokeOpacity","fillColor","fillOpacity"]:a===JXG.OBJECT_CLASS_POINT?e=["coords","face","size","color","opacity"].concat(e):a===JXG.OBJECT_CLASS_LINE?e=["lineEndings","dash","strokeWidth","strokeColor","strokeOpacity"].concat(e):a===JXG.OBJECT_CLASS_CIRCLE?e=["radius","centerVisible","dash","strokeWidth","strokeColor","strokeOpacity","fillColor","fillOpacity"].concat(e):b===JXG.OBJECT_TYPE_POLYGON?e=["innerPoints","dash","strokeWidth","strokeColor","strokeOpacity","fillColor","fillOpacity"].concat(e):b===JXG.OBJECT_TYPE_ANGLE?e=["radius","label","fontSize","textColor","dash","strokeWidth","strokeColor","strokeOpacity","fillColor","fillOpacity"]:b===JXG.OBJECT_TYPE_SECTOR?e=["label","fontSize","textColor","dash","strokeWidth","strokeColor","strokeOpacity","fillColor","fillOpacity"]:b===JXG.OBJECT_TYPE_GRID?e=["gridCell","gridLT","gridRB","dash","strokeWidth","strokeColor","strokeOpacity"]:a===JXG.OBJECT_CLASS_CURVE?e=["functionTerm","dash","strokeWidth","strokeColor","strokeOpacity","fillColor","fillOpacity"].concat(e):b===JXG.OBJECT_TYPE_TEXT?(e=["text","fontSize","textColor","fixed"],d&&d.getAttribute("isLabel")&&!JXG.isPoint(d.element)&&e.unshift("position","offset")):b===JXG.OBJECT_TYPE_TICKS&&(e=["drawLabels","drawZero","insertTicks","majorHeight","scaleSymbol","ticksDistance","minorTicks"]),e.indexOf("label")>-1&&!d.label&&(e.splice(e.indexOf("fontSize"),1),e.splice(e.indexOf("textColor"),1)),e}function f(b,c){var d=a.propObj.setAttribute(b);return a.propObj.borders&&a.propObj.borders.forEach(function(a){a.setAttribute(b)}),c&&a.propObj.vertices&&a.propObj.vertices.forEach(function(a){a.setAttribute(b)}),d}function g(a,b,c){var d=/^-?\d+\.?\d*$/,e=parseFloat(a);return JXG.exists(a)&&d.test(a)&&e>b-1e-5&&c+1e-5>e}function h(a){return parseFloat(a.toFixed(4))}function i(b,c){return JXG.deepCopy(JXG.deepCopy({type:"number"},c||{}),{get:function(){this.value=a.propObj.getAttribute(b)},set:function(){if(g(this.value,this.min,this.max)){var c={};return c[b]=parseFloat(this.value),a.propObj.setAttribute(c)}}})}function j(b,c){return{type:"checkbox",get:function(){var d=c?a.propObj[c]:a.propObj;this.value=d.getAttribute(b)},set:function(){var d={},e=c?a.propObj[c]:a.propObj;return d[b]=!!this.value,e.setAttribute(d)}}}function k(a){return a&&"none"!==a&&a.indexOf("#")<0?JXG.rgb2hex(a):a}function l(a){return"none"===a||3===JXG.rgbParser(a).length}var m=!1,n={},o={};return o.options={faces:[{id:"",title:"SelectOption"},{id:"o",title:"FaceCircle"},{id:"x",title:"FaceCross"},{id:"+",title:"FacePlus"},{id:"<>",title:"FaceDiamond"},{id:"[]",title:"FaceSquare"},{id:"^",title:"FaceUpTriangle"},{id:"v",title:"FaceDownTriangle"},{id:"<",title:"FaceLeftTriangle"},{id:">",title:"FaceRightTriangle"}],positions:[{id:"",title:"SelectOption"},{id:"lft",title:"PosLeft"},{id:"rt",title:"PosRight"},{id:"top",title:"PosCenter"}],dashes:[{id:"",title:"SelectOption"},{id:"0",title:"SolidLine"},{id:"1",title:"DottedLine"},{id:"2",title:"SmallDashes"},{id:"3",title:"MediumDashes"},{id:"4",title:"BigDashes"},{id:"5",title:"LargeGaps"},{id:"6",title:"SmallGaps"}],colors:["none","#000000","#eeeeee","#808080","#ff00ff","#cc0000","#ffa500","#ffff00","#3366ff","#00ffff","#006400","#00ff00"]},o.id="",o.items=[],o.updateView=angular.noop,o.onEnter=function(){m=!0,c.cancel(),o.fetch()},o.onExit=function(){m=!1,a.propObj=null,o.fetch()},b.customDownHandlers.push(function(){m&&(a.propObj=a.board.downObjects[0],o.fetch())}),b.customMoveHandlers.push(function(){m&&a.propObj&&o.fetch()}),o.validID=function(a){return a&&0!==a.indexOf("_")&&!a.match(/_ticks_\d+Label/)?a:""},o.fetch=function(){var b,c=[],f=[];JXG.isString(a.propObj)?(o.id=a.propObj,f=e(a.propObj)):(o.id=a.propObj?a.propObj.id:"",o.validID(o.id)&&(f=e(a.propObj.elementClass,a.propObj.type,a.propObj.elType,a.propObj))),f.forEach(function(a){b=n[a],JXG.isFalse(b&&b.get&&b.get())||(b.oldValue=JXG.isObject(b.value)?JXG.deepCopy({},b.value):b.value,b.id=a,c.push(b))}),o.items.length=0,JXG.extend(o.items,c),o.updateView(),d.select(a.propObj,!0)},o.needSave=function(){var b=0;return a.propObj&&o.items.forEach(function(a){JSON.stringify(a.value)!==JSON.stringify(a.oldValue)&&b++}),b>0},o.save=function(){if(a.propObj){var b,c=!1;o.items.forEach(function(a){JSON.stringify(a.value)!==JSON.stringify(a.oldValue)&&(b=a.set(),c=c||b,a.oldValue=JXG.isObject(a.value)?JXG.deepCopy({},a.value):a.value)}),c&&a.board.update()}},n.snapWidth={type:"range",min:1,max:100,get:function(){this.value=a.propObj.getAttribute("snapWidth")},set:function(){return g(this.value,this.min,this.max)?a.propObj.setAttribute({snapWidth:parseInt(this.value)}):void 0}},n.strokeWidth={type:"range",unit:"px",min:.5,max:50,step:.5,get:function(){this.value=a.propObj.getAttribute("strokeWidth")},set:function(){return g(this.value,this.min,this.max)?f({strokeWidth:parseFloat(this.value)}):void 0}},n.dash={type:"dash",get:function(){this.value=a.propObj.getAttribute("dash").toString()},set:function(){return this.value?f({dash:parseInt(this.value)}):void 0}},n.strokeOpacity={type:"range",unit:"%",min:1,max:100,get:function(){this.value=Math.round(100*a.propObj.getAttribute("strokeOpacity"))},set:function(){return f({strokeOpacity:.01*this.value})}},n.fillOpacity={type:"range",unit:"%",min:1,max:100,get:function(){this.value=Math.round(100*a.propObj.getAttribute("fillOpacity"))},set:function(){return a.propObj.setAttribute({fillOpacity:.01*this.value})}},n.opacity={type:"range",unit:"%",min:1,max:100,get:function(){this.value=Math.round(100*a.propObj.getAttribute("fillOpacity"))},set:function(){return a.propObj.setAttribute({strokeOpacity:.01*this.value,fillOpacity:.01*this.value})}},n.size={type:"size",unit:"px",min:.5,max:50,step:.5,get:function(){this.value={size:a.propObj.getAttribute("size"),zoom:a.propObj.getAttribute("zoom")},this.value.size=a.propObj.getAttribute("size"),this.value.zoom=a.propObj.getAttribute("zoom")},set:function(){if(g(this.value.size,this.min,this.max)){var b=parseFloat(this.value.size);return a.propObj.setAttribute({zoom:this.value.zoom,size:b,strokeWidth:b/10})}}},n.coords={type:"coords",get:function(){this.value={x:h(a.propObj.coords.usrCoords[1]),y:h(a.propObj.coords.usrCoords[2]),snapToGrid:a.propObj.getAttribute("snapToGrid"),snapToPoints:a.propObj.getAttribute("snapToPoints"),readonly:a.propObj.type===JXG.OBJECT_TYPE_CAS}},set:function(){var b=/^-?\d+\.?\d*$/,c=!this.value.readonly&&b.test(this.value.x)&&b.test(this.value.y),d=parseFloat(this.value.x),e=parseFloat(this.value.y),f=function(a){return Math.abs(a)<1e3},g=a.propObj.getAttribute("attractorDistance"),h=a.propObj.getAttribute("attractorUnit");return this.value.snapToPoints&&1e-5>g&&(g=Math.max(a.board.options.precision.hasPoint,10),h="screen"),c&&f(d)&&f(e)?(a.propObj.setAttribute({snapToGrid:this.value.snapToGrid,snapToPoints:this.value.snapToPoints,attractorDistance:g,attractorUnit:h}),a.propObj.setPositionDirectly(JXG.COORDS_BY_USER,[d,e])):void 0}},n.lineEndings={type:"lineEndings",get:function(){var b=a.propObj.visProp;this.value={restrictFirst:!b.straightfirst,restrictLast:!b.straightlast,arrowFirst:b.firstarrow,arrowLast:b.lastarrow}},set:function(){var b=this.value;return a.propObj.setAttribute({straightFirst:!b.restrictFirst,straightLast:!b.restrictLast,firstArrow:b.arrowFirst,lastArrow:b.arrowLast})}},n.face={type:"face",get:function(){this.value=a.propObj.getAttribute("face")},set:function(){return this.value?a.propObj.setAttribute({face:this.value}):void 0}},n.fixed={type:"checkbox",icon1:"lock",icon0:"unlock",get:function(){this.value=a.propObj.getAttribute("fixed")},set:function(){return f({fixed:this.value},!0)}},n.trace=j("trace"),n.strokeColor={type:"color",get:function(){this.value=k(a.propObj.getAttribute("strokeColor"))},set:function(){return l(this.value)?f({strokeColor:this.value}):void 0}},n.fillColor={type:"color",get:function(){this.value=k(a.propObj.getAttribute("fillColor"))},set:function(){return l(this.value)?a.propObj.setAttribute({fillColor:this.value}):void 0}},n.color={type:"color",get:function(){this.value=k(a.propObj.getAttribute("fillColor"))},set:function(){return l(this.value)?a.propObj.setAttribute({strokeColor:this.value,fillColor:this.value}):void 0}},n.radius={type:"number",step:.1,get:function(){this.value=h(a.propObj.Radius()),this.readonly=a.propObj.method&&"pointRadius"!==a.propObj.method},set:function(){return"pointRadius"===a.propObj.method?a.propObj.setRadius(this.value):void 0}},n.centerVisible=j("visible","center"),n.label={type:"label",get:function(){this.value={withLabel:!!a.propObj.getAttribute("withLabel"),name:a.propObj.getName()}},set:function(){this.value.name=this.value.name.replace(/(^\s*)|(\s*$)/g,"");var b=this.value.name&&this.value.name!==this.oldValue.name,c=b||this.value.withLabel&&this.value.name,d=!a.propObj.label;return a.propObj.setAttribute({withLabel:!!c}),b&&(a.propObj.setName(this.value.name),a.propObj.label.setAttribute({visible:!0}),this.value.withLabel=!0),c&&d?o.fetch():!c||n.fontSize.value&&n.textColor.value||(n.fontSize.get(),n.textColor.get(),o.updateView()),!0}},n.position={type:"position",get:function(){var a=this.element();this.value=a?a.getAttribute("position"):""},set:function(){var a=this.element();return a&&a.setAttribute({position:this.value})},element:function(){return a.propObj?a.propObj.label||a.propObj:null}},n.offset={type:"xy",min:-200,max:200,unit:"px",get:function(){var b=a.propObj.getAttribute("offset");this.value={x:b[0],y:b[1]}},set:function(){return g(this.value.x,this.min,this.max)&&g(this.value.y,this.min,this.max)?a.propObj.setAttribute({offset:[parseInt(this.value.x),parseInt(this.value.y)]}):void 0}},n.fontSize={type:"number",min:8,max:500,step:.5,get:function(){var a=this.element();this.value=a?a.getAttribute("fontSize"):""},set:function(){var a=this.element();return a&&g(this.value,this.min,this.max)?a.setAttribute({fontSize:parseFloat(this.value)}).updateSize():void 0},element:function(){return a.propObj?a.propObj.label||a.propObj:null}},n.textColor={type:"color",get:function(){var a=this.element();this.value=a?a.getAttribute("strokeColor"):""},set:function(){var a=this.element();return a&&this.value?a.setAttribute({strokeColor:this.value}):void 0},element:function(){return a.propObj?a.propObj.label||a.propObj:null}},n.draggable={type:"checkbox",get:function(){this.value=a.draggable},set:function(){return a.draggable=!!this.value,!0}},n.ignoreLabels={type:"checkbox",get:function(){this.value=a.board.attr.ignorelabels},set:function(){return a.board.attr.ignorelabels=!!this.value,!0}},n.grid={type:"checkbox",get:function(){this.value=a.board.grids.length>0&&a.board.grids[0].getAttribute("visible")},set:function(){var b={visible:!!this.value};return a.board.grids.forEach(function(a){a.setAttribute(b)}),!0}},n.axis={type:"checkbox",get:function(){var b=JXG.filterElements(a.board.objectsList,{type:JXG.OBJECT_TYPE_AXIS});this.value=b[0]&&b[0].getAttribute("visible")},set:function(){var b=JXG.filterElements(a.board.objectsList,{type:JXG.OBJECT_TYPE_AXIS}),c={visible:!!this.value};return b.forEach(function(a){a.setAttribute(c)}),!0}},n.gridCell={type:"xy",min:.5,max:50,step:.5,get:function(){var a=this.element();a&&(this.value={x:a.getAttribute("gridX"),y:a.getAttribute("gridY")})},set:function(){var a=this.element();return a&&g(this.value.x,this.min,this.max)&&g(this.value.y,this.min,this.max)?a.setAttribute({gridX:parseFloat(this.value.x),gridY:parseFloat(this.value.y)}):void 0},element:function(){return a.propObj&&a.propObj.type===JXG.OBJECT_TYPE_GRID?a.propObj:JXG.filterElements(a.board.objectsList,{type:JXG.OBJECT_TYPE_GRID})[0]}},n.gridLT={type:"xy",min:-500,max:500,get:function(){var b=a.propObj.getAttribute("topLeft");this.value=b?{x:b[0],y:b[1]}:{}},set:function(){var b=g(this.value.x,this.min,this.max)&&g(this.value.y,this.min,this.max);return a.propObj.visProp.topleft=b?[parseFloat(this.value.x),parseFloat(this.value.y)]:void 0,a.board.applyZoom(),!0}},n.gridRB={type:"xy",min:-500,max:500,get:function(){var b=a.propObj.getAttribute("bottomRight");this.value=b?{x:b[0],y:b[1]}:{}},set:function(){var b=g(this.value.x,this.min,this.max)&&g(this.value.y,this.min,this.max);return a.propObj.visProp.bottomright=b?[parseFloat(this.value.x),parseFloat(this.value.y)]:void 0,a.board.applyZoom(),!0}},n.ticksDistances={type:"xy",min:1,max:50,title:"ticksDistance",get:function(){var b=JXG.filterElements(a.board.objectsList,{type:JXG.OBJECT_TYPE_TICKS});b.length>1&&(this.value={x:b[0].getAttribute("ticksDistance"),y:b[1].getAttribute("ticksDistance")})},set:function(){var b=JXG.filterElements(a.board.objectsList,{type:JXG.OBJECT_TYPE_TICKS});return b.length>1&&g(this.value.x,this.min,this.max)&&g(this.value.y,this.min,this.max)?(b[0].setAttribute({ticksDistance:parseFloat(this.value.x)}),b[1].setAttribute({ticksDistance:parseFloat(this.value.y)}),!0):void 0}},n.origin={type:"xy",min:0,max:2e3,unit:"px",get:function(){this.value={x:a.board.origin.scrCoords[1],y:a.board.origin.scrCoords[2]}},set:function(){if(!(JXG.exists(this.value.x)&&!g(this.value.x,this.min,this.max)||JXG.exists(this.value.y)&&!g(this.value.y,this.min,this.max))){var b=JXG.exists(this.value.x)?parseInt(this.value.x):a.board.canvasWidth/2,c=JXG.exists(this.value.y)?parseInt(this.value.y):a.board.canvasHeight/2;return a.board.moveOrigin(b,c)}}},n.units={type:"xy",min:1,max:1e3,unit:"px",get:function(){this.value={x:a.board.unitX,y:a.board.unitY}},set:function(){return g(this.value.x,this.min,this.max)&&g(this.value.y,this.min,this.max)?(a.board.unitX=parseFloat(this.value.x),a.board.unitY=parseFloat(this.value.y),a.board.updateCoords().clearTraces().fullUpdate()):void 0}},n.majorHeight={type:"checkbox",get:function(){this.value=a.propObj.getAttribute("majorHeight")<0},set:function(){var b=Math.abs(a.propObj.getAttribute("majorHeight"));return a.propObj.setAttribute({majorHeight:this.value?-b:b})}},n.scaleSymbol={type:"text",get:function(){this.value=a.propObj.getAttribute("scaleSymbol")},set:function(){return a.propObj.setAttribute({scaleSymbol:this.value})}},n.innerPoints=j("hasInnerPoints"),n.drawLabels=j("drawLabels"),n.drawZero=j("drawZero"),n.insertTicks=j("insertTicks"),n.ticksDistance=i("ticksDistance",{min:1,max:50}),n.minorTicks=i("minorTicks",{min:0,max:9}),o}]),angular.module("geomeditApp").controller("PropCtrl",["$scope","properties","model","select",function(a,b,c,d){"use strict";a.options=b.options,a.items=b.items,a.sidebar.go("properties",!0),a.trimID=function(a){return a.replace(/.*Board\d*/,"")},a.info=function(b){var d={};return b=JXG.def(b,c.propObj),b&&b.getAttribute&&(d.id=b.id,d.type=b.type,d.elType=b.type===JXG.OBJECT_TYPE_AXISPOINT?"axispoint":b.type===JXG.OBJECT_TYPE_TICKS?"ticks":b.elType,d.description=a.trimID(d.id),d.description.indexOf(d.elType)<0&&(d.description+=": "+d.elType),d.visible=b.getAttribute("visible")),d},a.objects=function(){var d=(c.board?c.board.objectsList:[]).filter(function(c){return b.validID(a.trimID(c.id))});return d.reverse()},a.clearSelection=function(){c.propObj=null,b.fetch()},a.selectObject=function(a){c.propObj=a,b.fetch()},a.switchVisible=function(a){a=a?a:c.propObj,a.setAttribute({visible:!a.getAttribute("visible")})},a.removeObject=function(a){d.resetSelection(),c.board.removeObject(a)},a.highlight=function(){return d.highlight.apply(d,arguments)},b.updateView=function(){a.$applyAsync()},a.$watch(b.needSave,function(a){a&&b.save()})}]),angular.module("geomeditApp").filter("concatUnit",function(){"use strict";return function(a,b,c){return c=c?c:14,a+(b&&a.length<c?"("+b+")":"")}}),angular.module("geomeditApp").filter("truncate",function(){"use strict";return function(a,b,c){return a?(b=b?b:10,c=JXG.def(c,"…"),a.length<=b||a.length-c.length<=b?a:a.substring(0,b-c.length)+c):""}}),angular.module("geomeditApp").filter("camelCase",function(){"use strict";return function(a,b){return a?(a=b?a:"_"+a,a.replace(/_(.)/g,function(a,b){return b.toUpperCase()})):""}}),angular.module("geomeditApp").service("boardUI",["model","eventHandler","select",function(a,b,c){"use strict";function d(a,b,c){return Math.abs(a-b)<JXG.def(c,1)}this.initBoard=function(c){JXG.Options.axis=JXG.deepCopy(JXG.Options.axis,a.initOptions.axis),a.board=JXG.JSXGraph.initBoard(c,a.initAttr),a.board.moveOrigin(a.board.canvasWidth/2,a.board.canvasHeight/2),a.board.options=JXG.deepCopy(a.board.options,a.initOptions),b.registerHandlers()},this.freeBoard=function(){var d;return a.board&&(d=a.board.containerObj.id,b.unregisterHandlers(),a.propObj=null,c.resetSelection(),JXG.JSXGraph.freeBoard(a.board),a.board=null),d},this.resizeBoard=function(b,c){if(a.board&&(!d(a.board.canvasWidth,b)||!d(a.board.canvasHeight,c))){var e=d(a.board.origin.scrCoords[1],a.board.canvasWidth/2),f=d(a.board.origin.scrCoords[2],a.board.canvasHeight/2);a.board.resizeContainer(b,c,!1,!0),a.board.applyZoom(),(e||f)&&a.board.moveOrigin(e?a.board.canvasWidth/2:a.board.origin.scrCoords[1],f?a.board.canvasHeight/2:a.board.origin.scrCoords[2])}},this.zooms={zoomDefault:function(){return a.board.moveOrigin(a.board.canvasWidth/2,a.board.canvasHeight/2),a.board.zoom100()},zoomIn:function(){return a.board.zoomIn()},zoomOut:function(){return a.board.zoomOut()},clickLeftArrow:function(){return a.board.clickLeftArrow()},clickRightArrow:function(){return a.board.clickRightArrow()},clickUpArrow:function(){return a.board.clickUpArrow()},clickDownArrow:function(){return a.board.clickDownArrow()}}}]),angular.module("geomeditApp").service("loader",["$q","$timeout",function(a,b){"use strict";this.load=function(){var c=a.defer();return b(function(){c.resolve()},50),c.promise}}]),angular.module("geomeditApp").directive("newBoard",["loader","boardUI",function(a,b){"use strict";return{link:function(c,d,e){a.load().then(function(){b.initBoard(e.id)})}}}]),angular.module("geomeditApp").service("snap",["model",function(a){"use strict";function b(b,c,d){var f=a.board.options.precision.hasPoint;return c&&c.gliderFilter&&(c.glider=!0),{coords:b,hits:[],draftIDs:e(),masks:c||d&&d.masks,
snapSize:f,minDist:f,dist:0,snapped:null,glider:null}}function c(b){function c(a){return a&&a.coords?a:null}return b.glider&&(b.mid||b.cross||b.glider.slideObject!==b.snapped)&&(b.created===b.glider&&(b.created=null),a.board.removeObject(b.glider),b.glider=null),b.created=b.mid||b.cross||b.glider||b.created,b.oldSnapSize&&(a.board.options.precision.hasPoint=b.oldSnapSize),{coords:(c(b.created)||c(b.snapped)||b).coords,created:b.created,snapped:b.snapped,mid:b.mid,cross:b.cross,glider:b.glider,masks:b.masks,clear:function(){this.created&&(a.board.removeObject(this.created),this.created=null,this.mid=null,this.cross=null,this.glider=null),this.snapped=null},detach:function(){var a=this.created;return this.created=null,this.mid=null,this.cross=null,this.glider=null,this.snapped=null,a}}}function d(a,b){a.masks&&JXG.isFunction(a.masks.filter)?(g(a),a.masks.filter(a)):(b.point&&i(a),a.minDist>a.snapSize/4&&(g(a),b.mid&&k(a),b.cross&&p(a),b.glider&&m(a)))}function e(){var b=a.drafts.map(function(a){return a.id});return a.snaps.forEach(function(a){a.created&&b.push(a.created.id)}),b}function f(b,c){function d(a){var c=b.draftIDs&&b.draftIDs.indexOf(a.id)>=0;return a.parents.forEach(function(a){c=c||b.draftIDs&&b.draftIDs.indexOf(a)>=0}),c}function e(a){return a.type===JXG.OBJECT_TYPE_AXISPOINT&&JXG.cmpArrays(a.coords.usrCoords,[1,0,0])}b.coords&&a.board&&a.board.objectsList.forEach(function(f){var g=f!==b.created&&a.drafts.indexOf(f)<0;g&&!d(f)&&(f.visProp.visible||e(f))&&c(f)})}function g(a){function b(b){var c=b.elementClass;return(c===JXG.OBJECT_CLASS_LINE||c===JXG.OBJECT_CLASS_CIRCLE||c===JXG.OBJECT_CLASS_CURVE||b.borders)&&!l(a,b)}function c(b){return a.masks&&JXG.isFunction(a.masks.filter)&&JXG.isPoint(b)}function d(a,b,c){var d=a.hasPoint(b,c);return!d&&a.type===JXG.OBJECT_TYPE_POLYGON&&a.visProp.hasinnerpoints&&(a.visProp.hasinnerpoints=!1,d=a.hasPoint(b,c),a.visProp.hasinnerpoints=!0),d}f(a,function(e){(c(e)||b(e))&&d(e,a.coords.scrCoords[1],a.coords.scrCoords[2])&&a.hits.push(e)})}function h(a,b){return a.masks&&JXG.isFunction(a.masks.pointFilter)&&!a.masks.pointFilter(b)}function i(a){f(a,function(b){JXG.isPoint(b)&&b.hasPoint(a.coords.scrCoords[1],a.coords.scrCoords[2])&&!h(a,b)&&(a.dist=b.coords.distance(JXG.COORDS_BY_SCREEN,a.coords),a.minDist>a.dist&&(a.minDist=a.dist,a.snapped=b))})}function j(a){var b=a&&a.elementClass===JXG.OBJECT_CLASS_LINE;return b&&!a.straightFirst&&!a.straightLast&&!a.visProp.lastarrow}function k(b){var c;b.hits.forEach(function(d){j(d)&&(c=a.create("midpoint",[d],a.board.options.midpoint),b.dist=c.coords.distance(JXG.COORDS_BY_SCREEN,b.coords),b.minDist>b.dist?(b.minDist=b.dist,b.snapped=d,b.mid&&a.board.removeObject(b.mid),b.mid=c):a.board.removeObject(c))})}function l(a,b){return a.masks&&JXG.isFunction(a.masks.gliderFilter)&&!a.masks.gliderFilter(b)}function m(b){b.hits.forEach(function(c){var d,e=b.snapSize/2+1;l(b,c)||(b.glider&&b.glider.slideObject===c?(d=b.glider,d.setPositionDirectly(JXG.COORDS_BY_SCREEN,[b.coords.scrCoords[1],b.coords.scrCoords[2]]),e=1):d=a.create("glider",b.coords.usrCoords.slice(1).concat(c)),b.dist=d.coords.distance(JXG.COORDS_BY_SCREEN,b.coords)+e,b.minDist>b.dist?(b.minDist=b.dist,b.snapped=c,b.glider&&b.glider!==d&&a.board.removeObject(b.glider),b.glider=d):d!==b.glider&&a.board.removeObject(d))})}function n(a){return a.elementClass===JXG.OBJECT_CLASS_LINE||a.elementClass===JXG.OBJECT_CLASS_CIRCLE}function o(b,c,d){if(c.elementClass===JXG.OBJECT_CLASS_CIRCLE||d.elementClass===JXG.OBJECT_CLASS_CIRCLE){var e=a.create("intersection",[c,d,1]),f=e.coords.distance(JXG.COORDS_BY_SCREEN,b.coords);if(b.dist>f)return b.dist=f,e;a.board.removeObject(e)}}function p(b){var c,d,e=[0,0,0];b.hits.forEach(function(f,g){b.hits.forEach(function(h,i){if(g>i&&n(f)&&n(h)){if(c=a.create("intersection",[f,h,0]),JXG.cmpArrays(c.coords.usrCoords,e))return void a.board.removeObject(c);b.dist=c.coords.distance(JXG.COORDS_BY_SCREEN,b.coords),d=o(b,f,h),d&&(a.board.removeObject(c),c=d),b.minDist>b.dist?(b.minDist=b.dist,b.snapped=f,b.cross&&a.board.removeObject(b.cross),b.cross=c):a.board.removeObject(c)}})})}this.snapCoords=function(e,f,g){var h=b(e,g,f),i=h.masks||a.snap;return JXG.extend(h,{mid:null,cross:null,created:f?f.glider:null,glider:f?f.glider:null}),f&&f.created&&!f.glider&&a.board.removeObject(f.created),h.masks&&(h.oldSnapSize=a.board.options.precision.hasPoint,h.snapSize=Math.max(h.snapSize,60),h.minDist=h.snapSize,a.board.options.precision.hasPoint=h.snapSize),d(h,i),c(h)},this.hitTest=function(c,d){var e=b(c,d);return(!d||d.point)&&i(e),e.minDist>e.snapSize/4&&(!d||d.glider)&&(g(e),1===e.hits.length?e.snapped=e.hits[0]:e.hits.length>1&&(m(e),a.board.removeObject(e.glider))),e.snapped},this.isSegment=j}]),angular.module("geomeditApp").service("select",["model",function(a){"use strict";function b(b,c){return c.size=a.uiOptions.highlightSize,c.strokeWidth=0,c.snapToGrid=!1,c.fillColor=a.uiOptions.highlightColor,c.fillOpacity=a.uiOptions.highlightOpacity,a.create("point",[function(){return b.usrCoords[1]},function(){return b.usrCoords[2]}],c)}function c(e){var g,h;switch(h={id:f(),name:"",layer:1,withLabel:!1,highlighted:!0,strokeOpacity:a.uiOptions.highlightOpacity,strokeColor:a.uiOptions.highlightColor,strokeWidth:(e.getAttribute?e.getAttribute("strokeWidth"):0)+a.uiOptions.highlightSize},e.elementClass){case JXG.OBJECT_CLASS_POINT:g=b(e.coords,h);break;case JXG.OBJECT_CLASS_CIRCLE:g=a.create("circle",[e.center,e],h);break;case JXG.OBJECT_CLASS_LINE:h.straightFirst=e.getAttribute("straightFirst"),h.straightLast=e.getAttribute("straightLast"),g=a.create("line",[e.point1,e.point2],h);break;case JXG.OBJECT_CLASS_CURVE:g=d(e,h)}if(!g)switch(e.type){case JXG.OBJECT_TYPE_POLYGON:g=e.borders.map(function(a){return c(a)});break;case JXG.OBJECT_TYPE_TEXT:g=b(e.coords,h);break;case JXG.OBJECT_TYPE_TICKS:g=c(e.line)}return g}function d(b,c){var d;return b.type===JXG.OBJECT_TYPE_GRID?(c.strokeOpacity/=3,c.gridX=5*b.getAttribute("gridX"),c.gridY=5*b.getAttribute("gridY"),c.topLeft=b.getAttribute("topLeft"),c.bottomRight=b.getAttribute("bottomRight"),d=a.create("grid",[],c)):b.type===JXG.OBJECT_TYPE_ANGLE||b.type===JXG.OBJECT_TYPE_ARC||b.type===JXG.OBJECT_TYPE_SECTOR?(d=a.create("curve",[b.dataX,b.dataY],c),d.bezierDegree=3,d.prepareUpdate().update().updateRenderer()):d=a.create("curve",JXG.coordsArrayToMatrix(b.points,!0),c),d}var e=1,f=function(){return"_aux"+e++};this.select=function(b,d){d&&this.resetSelection();var e=b?c(b):null,f=function(c){c.highlight=angular.noop,c.reference=b,a.selection.push(c)};e&&(JXG.isArray(e)?e.forEach(f):f(e))},this.resetSelection=function(){for(;a.selection.length>0;)a.board.removeObject(a.selection.pop())},this.highlight=function(b,c){if(c)this.select(b);else if(b!==a.propObj)for(var d=a.selection.length-1;d>=0;d--)a.selection[d].reference===b&&a.board.removeObject(a.selection.splice(d,1)[0])}}]),angular.module("geomeditApp").service("motion",["model","snap",function(a,b){"use strict";function c(b,c){var d=b.detach()||!b.snapped&&a.create("point",b.coords.usrCoords.slice(1),c);return d&&a.pendings&&a.pendings.push(d),d}this.startPt=null,this.lastPt=null,this.pt=null,this.dragging=!1,this.updateStartCoords=function(a){this.startPt=this.lastPt=this.pt=this.getEventCoords(a)},this.updateCoords=function(a){this.pt=this.getEventCoords(a)},this.clear=function(){this.clearDrafts(),this.clearDraftCoords()},this.clearDraftCoords=function(){for(;a.snaps.length>0;)a.snaps.pop().clear();this.startPt=this.lastPt=this.pt=null},this.clearDrafts=function(){for(;a.drafts.length>0;)a.board.removeObject(a.drafts.pop())},this.getDraftCoords=function(b){return b=JXG.def(b,-1),b=0>b?a.snaps.length+b:b,a.snaps[b]},this.setDraftCoords=function(c,d){c=0>c?a.snaps.length+c:c,a.snaps[c]=b.snapCoords(this.pt,a.snaps[c],d)},this.updateDraftCoords=function(){var c=a.snaps.length-1;a.snaps[c]=b.snapCoords(this.pt,a.snaps[c])},this.addDraftCoords=function(c){var d=b.snapCoords(this.pt,null,c);return a.snaps.push(d),d},this.draftCoordsCount=function(){return a.snaps.length},this.hasDraftCoords=function(){return a.snaps.length>0},this.lastDraftCoordsIsNew=function(){var b=0;return a.snaps.length>1&&(b=this.getDraftCoords(-1).coords.distance(JXG.COORDS_BY_SCREEN,this.getDraftCoords(-2).coords)),b>5},this.createDraftPoint=function(b){function c(){var c=Math.min(b,a.snaps.length-1),d=c>=0&&a.snaps[c].snapped,e=d?a.snaps[c].created:null,f=e&&a.snaps[c].glider?.1:d?.4:1,g=e?e.visProp.strokecolor:i.strokecolor;h.setAttribute({size:d?j:i.size,fillOpacity:f,strokeColor:g})}var d=function(a){return a?a.point2?a.point2.coords:a.coords:null},e=function(c){var e=Math.min(b,a.snaps.length-1),f=0>e?null:a.snaps[e];return f?(d(f.created)||f.coords).usrCoords[c]:0},f=function(){return e(1)},g=function(){return e(2)},h=a.create("point",[f,g],{withLabel:!1}),i=JXG.deepCopy({},h.visProp),j=Math.max(a.board.options.precision.hasPoint,i.size+6);return h.coords.on("update",c,h),c(),a.drafts.push(h),h},this.createDraftPoints=function(a){var b=this;return a=JXG.isArray(a)?a:Array.prototype.slice.call(arguments),a.map(function(a){return b.createDraftPoint(a)})},this.createPoint=function(b,d,e){var f=JXG.isObject(b)?b:a.snaps[0>b?a.snaps.length+b:b];return d&&JXG.isPoint(f.snapped)&&!f.created?f.snapped:c(f,e)},this.createGlider=function(b,c){var d=a.create("glider",(c||this.pt).usrCoords.slice(1).concat(b));return d&&a.pendings&&a.pendings.push(d),d},this.createPoints=function(b){var c=this,d=a.snaps.map(function(a){return c.createPoint(a,!0,b)});return a.snaps.length=0,d},this.submit=function(b){var c,d=this,e=function(b){return a.pendings.indexOf(b)<0},f=function(b){JXG.isArray(b)?b.forEach(function(b){e(b)&&a.pendings.push(b),a.propObj=b}):(e(b)&&a.pendings.push(b),a.propObj=b)};try{d.clearDrafts(),a.pendings=[],c=b(),c&&f(c)}catch(g){for(;a.pendings.length>0;)a.board.removeObject(a.pendings.pop());throw g}finally{a.pendings=null,d.clearDraftCoords()}},this.isSegment=b.isSegment,this.hitTest=function(a){return b.hitTest(this.pt,a)},this.getMouseCoords=function(b){var c=JXG.getPosition(b),d=a.board.getCoordsTopLeftCorner(),e=c[0]-d[0],f=c[1]-d[1];return new JXG.Coords(JXG.COORDS_BY_SCREEN,[e,f],a.board)},this.getTouchCoords=function(b,c){var d=JXG.getPosition(b,c),e=a.board.getCoordsTopLeftCorner(),f=d[0]-e[0],g=d[1]-e[1];return new JXG.Coords(JXG.COORDS_BY_SCREEN,[f,g],a.board)},this.getEventCoords=function(a){return a[JXG.touchProperty]?this.getTouchCoords(a,-1):this.getMouseCoords(a)}}]),angular.module("geomeditApp").service("eventHandler",["model","motion",function(a,b){"use strict";function c(a){a.preventDefault()}function d(b){b?a.board.options.precision.hasPoint=a.board.options.precision.touch:a.snap.project&&(a.board.options.precision.hasPoint=a.board.options.precision.touch/2)}var e,f,g;this.touchMode=!1,this.customDownHandlers=[],this.customMoveHandlers=[],this.registerHandlers=function(){JXG.supportsPointerEvents()?(window.navigator.pointerEnabled?(e="pointerdown",f="pointerup",g="pointermove"):(e="MSPointerDown",f="MSPointerUp",g="MSPointerMove"),JXG.Options.device="msie"):JXG.isTouchDevice()||JXG.isFirefoxOS()?(e="touchstart",f="touchend",g="touchmove",JXG.Options.device="tablet"):(e="mousedown",f="mouseup",g="mousemove",JXG.Options.device="pc"),JXG.supportsPointerEvents()?this.addPointerHandlers():(this.addMouseHandlers(),this.addTouchHandlers()),JXG.addEvent(a.board.containerObj,e,this.downEventHandler,this),JXG.addEvent(a.board.containerObj,g,this.moveEventHandler,this),JXG.addEvent(a.board.containerObj,f,this.upEventHandler,this)},this.unregisterHandlers=function(){this.removePointerHandlers(),this.removeMouseHandlers(),this.removeTouchHandlers(),JXG.removeEvent(a.board.containerObj,e,this.downEventHandler,this),JXG.removeEvent(a.board.containerObj,g,this.moveEventHandler,this),JXG.removeEvent(a.board.containerObj,f,this.upEventHandler,this),b.clear()},this.addPointerHandlers=function(){!a.board.hasPointerHandlers&&JXG.isBrowser&&(JXG.addEvent(a.board.containerObj,g,a.board.pointerMoveListener,a.board),a.board.containerObj.addEventListener("MSHoldVisual",c,!1),a.board.containerObj.addEventListener("contextmenu",c,!1),a.board.containerObj.addEventListener("selectstart",c,!1),this.jxgDownHandler=function(){return a.board.pointerDownListener.apply(a.board,arguments)},a.board.hasPointerHandlers=!0,this.touchMode=!0)},this.addMouseHandlers=function(){!a.board.hasMouseHandlers&&JXG.isBrowser&&(JXG.addEvent(a.board.containerObj,"mousemove",a.board.mouseMoveListener,a.board),a.board.containerObj.addEventListener("contextmenu",c,!1),this.jxgDownHandler=function(){a.board.mouseDownListener.apply(a.board,arguments)},a.board.hasMouseHandlers=!0)},this.addTouchHandlers=function(){!a.board.hasTouchHandlers&&JXG.isBrowser&&(JXG.addEvent(a.board.containerObj,"touchmove",a.board.touchMoveListener,a.board),a.board.hasTouchHandlers=!0)},this.removePointerHandlers=function(){a.board.hasPointerHandlers&&(JXG.removeEvent(a.board.containerObj,g,a.board.pointerMoveListener,a.board),a.board.containerObj.removeEventListener("MSHoldVisual",c,!1),a.board.containerObj.removeEventListener("contextmenu",c,!1),a.board.containerObj.removeEventListener("selectstart",c,!1),a.board.hasPointerHandlers=!1)},this.removeMouseHandlers=function(){a.board.hasMouseHandlers&&(JXG.removeEvent(a.board.containerObj,"mousemove",a.board.mouseMoveListener,a.board),a.board.containerObj.removeEventListener("contextmenu",c,!1),a.board.hasMouseHandlers=!1)},this.removeTouchHandlers=function(){a.board.hasTouchHandlers&&(JXG.removeEvent(a.board.containerObj,"touchmove",a.board.touchMoveListener,a.board),a.board.hasTouchHandlers=!1)},this.downEventHandler=function(c){a.board.hasMouseHandlers&&c[JXG.touchProperty]&&(this.removeMouseHandlers(),this.jxgDownHandler=function(){a.board.touchStartListener.apply(a.board,arguments)},a.board.hasMouseHandlers=!1,this.touchMode=!0),d(this.touchMode),b.updateStartCoords(c),b.dragging=!0,a.command?((a.command.downHandler||angular.noop)(),a.board.update()):a.draggable&&(this.jxgDownHandler||angular.noop)(c),angular.element("body").click(),this.customDownHandlers.forEach(function(a){a(c)})},this.moveEventHandler=function(c){b.dragging&&(d(this.touchMode),b.updateCoords(c),this.customMoveHandlers.forEach(function(a){a(c)}),a.command&&(a.command.moveHandler?a.command.moveHandler():b.hasDraftCoords()&&b.updateDraftCoords(),a.board.update(),b.lastPt=b.pt))},this.upEventHandler=function(c){b.dragging&&(b.updateCoords(c),b.dragging=!1,a.command&&((a.command.upHandler||angular.noop)(),b.hasDraftCoords()&&!b.lastDraftCoordsIsNew()&&a.command.clickHandler&&a.command.clickHandler(),a.board.update()))}}]),angular.module("geomeditApp").controller("ToolboxCtrl",["$scope",function(a){"use strict";a.sidebar.go("toolbox",!0)}]),angular.module("geomeditApp").controller("CmdContextCtrl",["$scope","model",function(a,b){"use strict";a.context={applyContext:function(){a.$applyAsync()}},b.context=a.context}]),angular.module("geomeditApp").service("commands",["model","motion","select",function(a,b,c){"use strict";var d=0,e=null;this.groups=function(){return d!==a.commands.length&&(d=a.commands.length,e=a.cmdGroups.map(function(a){return{name:a.name,commands:a.commands.map(function(a){return a.id})}})),e},this.active=function(){return a.command?a.command.id:""},this.cancel=function(){var c=!!a.command;return a.command&&((a.command.cancelled||angular.noop)(),a.command=null,a.context.tip=null,a.context.input=null,b.clear()),c},this.start=function(b,c){c||this.resetSelection();var d=this.cancel();return a.command=a.findCommand(b),a.command&&(JXG.isFalse((a.command.inited||angular.noop)())?a.command=null:d=!0),d},this.resetSelection=function(){a.propObj=null,c.resetSelection()}}]),angular.module("geomeditApp").service("cmdAux",["model","motion",function(a,b){"use strict";function c(a){JXG.isFunction(a.snapFilter)&&(a.snapMasks=a.snapMasks||{},a.snapMasks.filter=a.snapFilter),a.afterCreated=a.afterCreated||function(a){return a}}function d(b,c){b.tip&&(JXG.isString(b.tip)?a.context.tip=b.tip:JXG.isFunction(b.tip)&&(a.context.tip=b.tip(c),a.context.applyContext()))}function e(a,b,c){var e={step:0};return a.tip=a.tip||"Tip_"+a.id,a.cmd=e,e.downHandler=JXG.isFunction(a.tip)?function(){b(),d(a,e.step)}:b,e.upHandler=JXG.isFunction(a.tip)?function(){c(),d(a,e.step)}:c,e.inited=function(){return e.step=0,JXG.isFunction(a.inited)&&JXG.isFalse(a.inited())?!1:void d(a,e.step)},JXG.isFunction(a.cancelled)&&(e.cancelled=a.cancelled),JXG.isFunction(a.clickHandler)&&(e.clickHandler=a.clickHandler),e}this.generateTip=function(a){return function(b){return a[Math.min(b,a.length-1)]}},this.addPointCommand=function(d){function f(){b.setDraftCoords(0,d.snapMasks),b.createDraftPoint(0)}function g(){b.submit(function(){var a=b.getDraftCoords().created;return!d.snapMasks||JXG.isPoint(a)?b.createPoint(0):JXG.isFunction(d.defaultCreator)&&d.defaultCreator()})}c(d),a.addCommand(d.group||"point",d.id,e(d,f,g))},this.snapMasksForLine={gliderFilter:function(a){return a.elementClass===JXG.OBJECT_CLASS_LINE}},this.snapMasksForTriangle={gliderFilter:function(a){return a.type===JXG.OBJECT_TYPE_POLYGON&&3===a.borders.length}},this.snapMasksForCircle={gliderFilter:function(a){return a.type===JXG.OBJECT_TYPE_CIRCLE}},this.perpendicularFilter=function(b){var c;b.hits.forEach(function(d){JXG.isPoint(a.drafts[0])&&d.elementClass===JXG.OBJECT_CLASS_LINE&&(c=a.create("perpendicularPoint",[a.drafts[0],d],a.initOptions.perpendicularPoint),b.dist=c.coords.distance(JXG.COORDS_BY_SCREEN,b.coords),b.minDist>b.dist?(b.minDist=b.dist,b.snapped=d,b.created&&a.board.removeObject(b.created),b.created=c):a.board.removeObject(c))})},this.addCommandSnapSecond=function(d){function f(){if(b.hasDraftCoords())b.updateDraftCoords();else{b.addDraftCoords(),b.addDraftCoords(d.snapMasks);var c=a.create("segment",b.createDraftPoints(0,1),{strokeWidth:1,dash:2});a.drafts.push(d.afterCreated(c))}d.cmd.step=2}function g(){b.lastDraftCoordsIsNew()?(d.cmd.step=0,b.submit(function(){var c=b.getDraftCoords();if(c.snapped){if(JXG.isFunction(d.creator))return d.creator(b.createPoint(0,!0),c);var e=[b.createPoint(0,!0),c.snapped];return"mirrorpoint"===c.created.elType&&e.reverse(),d.afterCreated(a.create(c.created.elType,e,d.attr))}})):d.cmd.step=1}c(d),a.addCommand(d.group||"point",d.id,e(d,f,g))},this.addLineCommand=function(d){function f(){if(b.hasDraftCoords())b.updateDraftCoords();else{b.addDraftCoords(),b.addDraftCoords();var c=a.create(d.type,b.createDraftPoints(0,1),d.attr);a.drafts.push(d.afterCreated(c))}d.cmd.step=2}function g(){b.lastDraftCoordsIsNew()?(d.cmd.step=0,b.submit(function(){var c=b.createPoint(0,!0,d.attrP1),e=b.createPoint(1,!0,d.attrP2);return d.afterCreated(a.create(d.type,[c,e],d.attr))})):d.cmd.step=1}c(d),a.addCommand(d.group||"line",d.id,e(d,f,g))},this.addCommandSnapFirst=function(d){function f(){b.hasDraftCoords()?b.updateDraftCoords():b.addDraftCoords(d.snapMasks).snapped?(b.addDraftCoords(),a.drafts.push(d.creator(b.getDraftCoords(0),b.createDraftPoint(1)))):b.clearDraftCoords(),d.cmd.step=2}function g(){b.lastDraftCoordsIsNew()?(d.cmd.step=0,b.submit(function(){return d.creator(b.getDraftCoords(0),b.createPoint(1,!0,d.attr))})):d.cmd.step=1}c(d),a.addCommand(d.group||"line",d.id,e(d,f,g))},this.addCommand3p=function(d){function f(){var c=b.draftCoordsCount();1>c?(b.addDraftCoords(),b.addDraftCoords(),h=b.createDraftPoints(0,1,2),d.cmd.step=1):3>c&&b.lastDraftCoordsIsNew()?(b.addDraftCoords(),a.drafts.push(d.afterCreated(a.create(d.type,h),h))):b.updateDraftCoords(),d.cmd.step++}function g(){b.lastDraftCoordsIsNew()?(d.cmd.step++,3===b.draftCoordsCount()&&(d.cmd.step=0,b.submit(function(){return h=b.createPoints(),d.afterCreated(a.create(d.type,h),h)}))):d.cmd.step--}var h;c(d),a.addCommand(d.group||"circle",d.id,e(d,f,g))},this.addPolygonCommand=function(d){function f(){var c=b.draftCoordsCount();if(1>c){b.addDraftCoords(),b.addDraftCoords(),d.cmd.step=1;var e,f=[];for(e=0;e<d.maxCount;e++)f[e]=e;a.drafts.push(a.create("polygon",b.createDraftPoints(f)))}else b.lastDraftCoordsIsNew()&&c<d.maxCount?b.addDraftCoords():b.updateDraftCoords();d.cmd.step++}function g(){b.lastDraftCoordsIsNew()?(d.cmd.step++,b.draftCoordsCount()===d.maxCount&&(d.cmd.step=0,b.submit(function(){return a.create("polygon",b.createPoints())}))):d.cmd.step--}c(d),a.addCommand(d.group||"polygon",d.id,e(d,f,g))}}]),angular.module("geomeditApp").run(["model","motion","cmdAux",function(a,b,c){"use strict";function d(a,b,c){return(a.coords.scrCoords[c]+b.coords.scrCoords[c])/2}function e(b,c){var e=d(c,a.drafts[0],1)-b.coords.scrCoords[1],f=d(c,a.drafts[0],2)-b.coords.scrCoords[2];return Math.sqrt(e*e+f*f)}function f(b,c){var d=a.create("reflection",[a.drafts[0],c]);b.dist=e(b,d),b.minDist>b.dist?(b.minDist=b.dist,b.snapped=c,b.created&&a.board.removeObject(b.created),b.created=d):a.board.removeObject(d)}function g(b,c){var d=a.create("mirrorPoint",[c,a.drafts[0]]);b.dist=e(b,d),b.minDist>b.dist?(b.minDist=b.dist,b.snapped=c,b.created&&a.board.removeObject(b.created),b.created=d):a.board.removeObject(d)}c.addPointCommand({id:"point"}),c.addPointCommand({id:"midpoint",snapMasks:{mid:!0},defaultCreator:function(){var d=b.hitTest(c.snapMasksForLine);return b.isSegment(d)?a.create("midpoint",[d],a.board.options.midpoint):void 0}}),c.addPointCommand({id:"intersection",snapMasks:{cross:!0}}),c.addPointCommand({id:"glider",snapMasks:{glider:!0}}),c.addCommandSnapSecond({id:"perpPoint",snapFilter:c.perpendicularFilter,attr:a.initOptions.perpendicularPoint,tip:c.generateTip(["TipClkDragStart","TipClkDragToLine","TipDragToLine"])}),c.addCommandSnapSecond({id:"reflection",snapFilter:function(b){b.hits.forEach(function(c){a.drafts[0]&&c.elementClass===JXG.OBJECT_CLASS_LINE?f(b,c):a.drafts[0]&&JXG.isPoint(c)&&g(b,c)})},attr:a.initOptions.perpendicularPoint,tip:c.generateTip(["TipClkDragFromPt","TipClkDragToPtLn","TipDragToPtLn"])}),c.addCommand3p({group:"point",id:"in_center",type:"incenter",clickHandler:function(){var d=b.hitTest(c.snapMasksForTriangle);d&&d.vertices&&b.submit(function(){return a.create("incenter",d.vertices)})},tip:c.generateTip(["Tip3triangle","TipClkDragToP2","TipDragToP2","TipClkDragToEnd","TipDragToEnd"])})}]),angular.module("geomeditApp").run(["model","motion","cmdAux",function(a,b,c){"use strict";var d=function(a){return c.generateTip([a,"TipClkDragToEnd","TipDragToEnd"])},e=d("TipClkDragStart"),f=d("TipClkDragLine"),g=c.generateTip(["TipClkDragStart","TipClkDragToLine","TipDragToLine"]);c.addLineCommand({id:"segment",type:"segment",tip:e}),c.addLineCommand({id:"ray",type:"line",tip:e,attr:{straightFirst:!1}}),c.addLineCommand({id:"line",type:"line",tip:e}),c.addCommandSnapFirst({id:"parallel",attr:{visible:!1},tip:f,snapMasks:c.snapMasksForLine,creator:function(b,c){return a.create("parallel",[b.snapped,c])}}),c.addCommandSnapSecond({group:"line",id:"perpSegment",tip:g,snapFilter:c.perpendicularFilter,creator:function(b,c){return a.create("perpendicularSegment",[c.snapped,b])}}),c.addCommandSnapSecond({group:"line",id:"perpLine",tip:g,snapFilter:c.perpendicularFilter,creator:function(b,c){return a.create("perpendicular",[c.snapped,b])},clickHandler:function(){var d=b.hitTest(c.snapMasksForLine);d&&b.submit(function(){var c=b.hitTest({point:!0})||b.createGlider(d);return a.create("perpendicular",[d,c])})}}),c.addCommand3p({group:"line",id:"bisector",type:"bisector",tip:c.generateTip(["TipClkDragFromPt","TipDragToP2","TipClkDragToP2","TipDragToEnd","TipDragToEnd"])})}]),angular.module("geomeditApp").run(["model","motion","cmdAux",function(a,b,c){"use strict";var d=c.generateTip(["TipClkDragFromPt","TipClkDragToP2","TipDragToP2","TipClkDragToEnd","TipDragToEnd"]),e=c.generateTip(["TipClkDragFromPt","TipClkDragToP2","TipDragToP2","TipClkDragToP3","TipDragToP3","TipClkDragToEnd","TipDragToEnd"]),f=["TipClkDragStart","TipClkDragToP2","TipDragToP2","TipClkDragToP3","TipDragToP3","TipClkDragToPn","TipDragToPn"];c.addPolygonCommand({id:"triangle",maxCount:3,tip:d}),c.addPolygonCommand({id:"quadrangle",maxCount:4,tip:e}),c.addCommand3p({group:"polygon",id:"parallelogram",type:"parallelpoint",tip:d,afterCreated:function(b,c){return b.setAttribute({visible:!1}),[b,a.create("polygon",[c[0],c[1],b,c[2]])]}}),c.addPolygonCommand({id:"polygon",maxCount:20,cancelled:function(){for(;b.draftCoordsCount()>1&&!b.lastDraftCoordsIsNew();)a.snaps.pop().clear();b.draftCoordsCount()>2&&b.submit(function(){return a.create("polygon",b.createPoints())})},tip:function(a){return 5>a?f[a]:f[a%2?5:6]}})}]),angular.module("geomeditApp").run(["model","motion","cmdAux",function(a,b,c){"use strict";var d=c.generateTip(["TipClkDragFromPt","TipClkDragToP2","TipDragToP2","TipClkDragToEnd","TipDragToEnd"]),e=c.generateTip(["TipCircle2p","TipClkDragToRadius","TipDragToRadius"]);c.addCommand3p({id:"circle3p",type:"circumCircle",tip:d,clickHandler:function(){var d=b.hitTest(c.snapMasksForTriangle);d&&d.vertices&&b.submit(function(){return a.create("circumCircle",d.vertices)})}}),c.addCommand3p({id:"in_circle",type:"inCircle",tip:d}),c.addLineCommand({group:"circle",id:"circle2p",type:"circle",attrP2:{visible:!1},tip:function(b){return a.context.input=a.context.input||{title:"radius",hide:function(){return a.context.step>1}},a.context.step=b,e(b)},clickHandler:function(){var c=a.context.input,d=c&&!c.hide()&&c.value;d&&b.submit(function(){var c=b.createPoint(0,!0);return a.create("circle",[c,d])})}})}]);